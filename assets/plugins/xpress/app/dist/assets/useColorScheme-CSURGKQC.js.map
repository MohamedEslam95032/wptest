{"version":3,"file":"useColorScheme-CSURGKQC.js","sources":["../../src/assets/js/functions/useColorScheme.js"],"sourcesContent":["import { ref, computed, watch } from \"vue\";\nimport { useAppStore } from \"@/store/app/app.js\";\n\nconst prefersDark = ref(false);\nconst userPreference = ref(\"system\");\nconst listenersMounted = ref(false);\nlet mediaQuery = null;\nlet appStore;\n\n// Define globalOverride before updateColorScheme so it's available when needed\nconst globalOverride = computed(() => {\n  if (!appStore) {\n    appStore = useAppStore();\n  }\n\n  const isOverride = appStore?.state?.uixpress_settings?.force_global_theme;\n\n  return isOverride == \"off\" || !isOverride ? false : isOverride;\n});\n\nconst updateColorScheme = () => {\n  // Check for global override first - this takes precedence over everything\n  if (globalOverride.value) {\n    prefersDark.value = globalOverride.value === \"dark\";\n    return;\n  }\n\n  // No global override, use user preference or system preference\n  const isDarkMode = userPreference.value === \"dark\" || (userPreference.value === \"system\" && window.matchMedia(\"(prefers-color-scheme: dark)\").matches);\n  prefersDark.value = isDarkMode;\n};\n\nconst setColorScheme = (newScheme, dontDispatchChange) => {\n  if ([\"light\", \"dark\", \"system\"].includes(newScheme)) {\n    userPreference.value = newScheme;\n    localStorage.setItem(\"uipc_theme\", newScheme);\n    updateColorScheme();\n\n    // Dispatch change for VendBase\n    if (!dontDispatchChange) {\n      const themeUpdateEvent = new CustomEvent(\"uipx-theme-update\", { detail: newScheme });\n      document.dispatchEvent(themeUpdateEvent);\n    }\n  }\n};\n\nexport const setupColorScheme = () => {\n  userPreference.value = localStorage.getItem(\"uipc_theme\") || \"system\";\n  updateColorScheme();\n\n  if (window.matchMedia) {\n    mediaQuery = window.matchMedia(\"(prefers-color-scheme: dark)\");\n    mediaQuery.addEventListener(\"change\", updateColorScheme);\n  }\n};\n\nexport const cleanupColorScheme = () => {\n  if (mediaQuery) {\n    mediaQuery.removeEventListener(\"change\", updateColorScheme);\n  }\n};\n\nexport const useColorScheme = () => {\n  if (!listenersMounted.value) {\n    listenersMounted.value = true;\n    document.addEventListener(\"uipx-theme-update\", (evt) => {\n      if (!evt.detail) return;\n      setColorScheme(evt.detail, true);\n    });\n\n    // Watch for changes to globalOverride and update prefersDark accordingly\n    watch(globalOverride, () => {\n      updateColorScheme();\n    }, { immediate: false });\n  }\n\n  const colorScheme = computed(() => {\n    // Global override\n    if (globalOverride.value) return globalOverride.value;\n\n    if (userPreference.value !== \"system\") {\n      return userPreference.value;\n    }\n    return prefersDark.value ? \"dark\" : \"light\";\n  });\n\n  return {\n    prefersDark,\n    colorScheme,\n    setColorScheme,\n    userPreference,\n    globalOverride,\n  };\n};\n"],"names":["prefersDark","ref","userPreference","listenersMounted","mediaQuery","appStore","globalOverride","computed","useAppStore","isOverride","_b","_a","updateColorScheme","isDarkMode","setColorScheme","newScheme","dontDispatchChange","themeUpdateEvent","setupColorScheme","useColorScheme","evt","watch","colorScheme"],"mappings":"iFAGA,MAAMA,EAAcC,EAAI,EAAK,EACvBC,EAAiBD,EAAI,QAAQ,EAC7BE,EAAmBF,EAAI,EAAK,EAClC,IAAIG,EAAa,KACbC,EAGJ,MAAMC,EAAiBC,EAAS,IAAM,SAC/BF,IACHA,EAAWG,EAAW,GAGxB,MAAMC,GAAaC,GAAAC,EAAAN,GAAA,YAAAA,EAAU,QAAV,YAAAM,EAAiB,oBAAjB,YAAAD,EAAoC,mBAEvD,OAAOD,GAAc,OAAS,CAACA,EAAa,GAAQA,CACtD,CAAC,EAEKG,EAAoB,IAAM,CAE9B,GAAIN,EAAe,MAAO,CACxBN,EAAY,MAAQM,EAAe,QAAU,OAC7C,MACF,CAGA,MAAMO,EAAaX,EAAe,QAAU,QAAWA,EAAe,QAAU,UAAY,OAAO,WAAW,8BAA8B,EAAE,QAC9IF,EAAY,MAAQa,CACtB,EAEMC,EAAiB,CAACC,EAAWC,IAAuB,CACxD,GAAI,CAAC,QAAS,OAAQ,QAAQ,EAAE,SAASD,CAAS,IAChDb,EAAe,MAAQa,EACvB,aAAa,QAAQ,aAAcA,CAAS,EAC5CH,EAAiB,EAGb,CAACI,GAAoB,CACvB,MAAMC,EAAmB,IAAI,YAAY,oBAAqB,CAAE,OAAQF,EAAW,EACnF,SAAS,cAAcE,CAAgB,CACzC,CAEJ,EAEaC,EAAmB,IAAM,CACpChB,EAAe,MAAQ,aAAa,QAAQ,YAAY,GAAK,SAC7DU,EAAiB,EAEb,OAAO,aACTR,EAAa,OAAO,WAAW,8BAA8B,EAC7DA,EAAW,iBAAiB,SAAUQ,CAAiB,EAE3D,EAQaO,EAAiB,IAAM,CAC7BhB,EAAiB,QACpBA,EAAiB,MAAQ,GACzB,SAAS,iBAAiB,oBAAsBiB,GAAQ,CACjDA,EAAI,QACTN,EAAeM,EAAI,OAAQ,EAAI,CACjC,CAAC,EAGDC,EAAMf,EAAgB,IAAM,CAC1BM,EAAiB,CACnB,EAAG,CAAE,UAAW,GAAO,GAGzB,MAAMU,EAAcf,EAAS,IAEvBD,EAAe,MAAcA,EAAe,MAE5CJ,EAAe,QAAU,SACpBA,EAAe,MAEjBF,EAAY,MAAQ,OAAS,OACrC,EAED,MAAO,CACL,YAAAA,EACA,YAAAsB,EACA,eAAAR,EACA,eAAAZ,EACA,eAAAI,CACJ,CACA"}