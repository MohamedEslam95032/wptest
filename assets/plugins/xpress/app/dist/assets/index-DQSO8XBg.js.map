{"version":3,"file":"index-DQSO8XBg.js","sources":["../../src/components/utility/multiselect-roles-and-users/index.vue"],"sourcesContent":["<script setup>\nimport { ref, onMounted, watchEffect, computed, useAttrs, defineModel, defineProps } from \"vue\";\n\nimport { inSearch } from \"@/assets/js/functions/inSearch.js\";\n\n// Emits and props\nconst attrs = useAttrs();\nimport { lmnFetch } from \"@/assets/js/functions/lmnFetch.js\";\n\n// Import comps\nimport ContextMenu from \"@/components/utility/context-menu/index.vue\";\nimport AppIcon from \"@/components/utility/icons/index.vue\";\nimport AppInput from \"@/components/utility/text-input/index.vue\";\nimport AppCheckBox from \"@/components/utility/checkbox-basic/index.vue\";\nimport AppToggle from \"@/components/utility/toggle/index.vue\";\nimport AppButton from \"@/components/utility/app-button/index.vue\";\n\n// Setup refs\nconst model = defineModel();\nconst search = ref(\"\");\nconst parent = ref(null);\nconst contextmenu = ref(null);\nconst props = defineProps([\"options\", \"placeholder\"]);\nconst userPagination = ref({ per_page: 10, page: 1, pages: 0, total: 0 });\nconst users = ref([]);\nconst roles = ref([]);\nconst toggleOptions = { users: { value: \"users\", label: __(\"Users\", \"uixpress\") }, roles: { value: \"roles\", label: __(\"Roles\", \"uixpress\") } };\nconst tab = ref(\"roles\");\n\nconst showOptions = async (evt) => {\n  contextmenu.value.show(evt, returnThisPos());\n  await getUsers();\n  getRoles();\n\n  if (!Array.isArray(model.value)) {\n    model.value = [];\n  }\n};\n\nconst getUsers = async () => {\n  const args = { endpoint: \"wp/v2/users\", params: { ...userPagination.value, search: search.value } };\n  const response = await lmnFetch(args);\n\n  // Something went wrong\n  if (!response) return;\n\n  users.value = response.data;\n  userPagination.value.pages = response.totalPages;\n  userPagination.value.total = response.totalItems;\n};\n\nconst getRoles = async () => {\n  const args = { endpoint: \"uixpress/v1/user-roles\", params: {} };\n  const response = await lmnFetch(args);\n\n  // Something went wrong\n  if (!response) return;\n\n  roles.value = response.data;\n};\n\n/**\n * Returns postition of current target\n *\n * @since 0.0.1\n */\nconst returnThisPos = (evt) => {\n  const target = parent.value;\n  const rect = target.getBoundingClientRect();\n  return { clientY: rect.bottom + 10, clientX: rect.left };\n};\n\nconst isUserSelected = (item) => {\n  if (!Array.isArray(model.value)) {\n    model.value = [];\n    return false;\n  }\n  return model.value.find((user) => user.id == item.id);\n};\n\nconst toggleUserItem = (item) => {\n  if (isUserSelected(item)) {\n    const index = model.value.findIndex((user) => user.id == item.id);\n    model.value.splice(index, 1);\n  } else {\n    model.value.push({ id: item.id, value: item.slug, type: \"user\" });\n  }\n};\n\nconst isRoleSelected = (item) => {\n  if (!Array.isArray(model.value)) {\n    model.value = [];\n    return false;\n  }\n  return model.value.find((role) => role.value == item.value);\n};\n\nconst toggleRoleItem = (item) => {\n  if (isRoleSelected(item)) {\n    const index = model.value.findIndex((role) => role.value == item.value);\n    model.value.splice(index, 1);\n  } else {\n    model.value.push({ id: \"\", value: item.value, type: \"role\" });\n  }\n};\n\nconst backPage = () => {\n  userPagination.value.page--;\n  getUsers();\n};\nconst nextPage = () => {\n  userPagination.value.page++;\n  getUsers();\n};\n\nwatchEffect(() => {\n  if (!Array.isArray(model.value)) model.value = [];\n});\n</script>\n\n<template>\n  <div\n    v-if=\"model\"\n    @click=\"showOptions\"\n    v-bind=\"attrs\"\n    ref=\"parent\"\n    class=\"px-2 py-2 border border-zinc-200 dark:border-zinc-700 rounded-lg w-full transition-all outline outline-transparent outline-offset-[-2px] focus:outline-indigo-300 dark:focus:outline-indigo-700 focus:shadow-xs text-sm col-span-2 flex flex-row gap-3 items-center\"\n  >\n    <span v-if=\"model.length\" class=\"grow\">{{ `${model.length} ${__(\"Items selected\", \"uixpress\")}` }}</span>\n    <span v-else class=\"text-zinc-500 grow\">{{ __(\"Select users or roles\", \"uixpress\") }}</span>\n    <AppButton type=\"transparent\" v-if=\"model.length\" @click.stop.prevent=\"model = []\"><AppIcon icon=\"close\" /></AppButton>\n    <AppIcon icon=\"unfold\" />\n  </div>\n\n  <ContextMenu ref=\"contextmenu\">\n    <div class=\"flex flex-col gap-3 w-[260px]\">\n      <AppToggle v-model=\"tab\" :options=\"toggleOptions\" />\n\n      <!-- Search -->\n      <div class=\"relative flex\">\n        <input\n          v-model=\"search\"\n          class=\"px-2 py-2 pl-8 border border-zinc-200 dark:border-zinc-700 rounded-lg w-full transition-all outline outline-transparent outline-offset-[-2px] focus:outline-indigo-300 dark:focus:outline-indigo-700 focus:shadow-xs text-sm dark:bg-transparent\"\n          :placeholder=\"__('Search')\"\n          @keyup.enter=\"getUsers\"\n        />\n\n        <!-- Icon-->\n        <div class=\"absolute top-0 left-0 h-full flex flex-col place-content-center px-2 py-1\">\n          <AppIcon icon=\"search\" class=\"text-lg text-zinc-400\" />\n        </div>\n      </div>\n\n      <!-- Loop users -->\n      <div v-if=\"tab === 'users'\" class=\"flex flex-col max-h-80 overflow-auto\">\n        <template v-for=\"option in users\">\n          <div class=\"flex flex-row items-center gap-3 p-2 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors rounded-lg cursor-pointer\" @click=\"toggleUserItem(option)\">\n            <AppCheckBox :checked=\"isUserSelected(option) ? true : false\" />\n            <div>{{ option.slug }}</div>\n          </div>\n        </template>\n      </div>\n\n      <!-- Loop roles -->\n      <div v-if=\"tab === 'roles'\" class=\"flex flex-col max-h-80 overflow-auto\">\n        <template v-for=\"option in roles\">\n          <div class=\"flex flex-row items-center gap-3 p-2 hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors rounded-lg cursor-pointer\" @click=\"toggleRoleItem(option)\">\n            <AppCheckBox :checked=\"isRoleSelected(option) ? true : false\" />\n            <div>{{ option.value }}</div>\n          </div>\n        </template>\n      </div>\n\n      <!-- Pagination -->\n      <div class=\"flex flex-row place-content-end items-center gap-1\" v-if=\"tab == 'users'\">\n        <AppButton type=\"default\" :disabled=\"userPagination.page == 1\" @click=\"backPage\"><AppIcon icon=\"chevron_left\" /></AppButton>\n        <AppButton type=\"default\" :disabled=\"userPagination.page >= userPagination.pages\" @click=\"nextPage\"><AppIcon icon=\"chevron_right\" /></AppButton>\n      </div>\n    </div>\n  </ContextMenu>\n</template>\n"],"names":["attrs","useAttrs","model","_useModel","search","ref","parent","contextmenu","userPagination","users","roles","toggleOptions","tab","showOptions","evt","returnThisPos","getUsers","getRoles","args","response","lmnFetch","rect","isUserSelected","item","user","toggleUserItem","index","isRoleSelected","role","toggleRoleItem","backPage","nextPage","watchEffect","_openBlock","_createElementBlock","_mergeProps","_unref","_hoisted_1","_toDisplayString","__","_hoisted_2","_createBlock","AppButton","_createVNode","AppIcon","ContextMenu","_createElementVNode","_hoisted_3","AppToggle","$event","_hoisted_4","_hoisted_6","_hoisted_7","_Fragment","_renderList","option","AppCheckBox","_hoisted_9","_hoisted_11"],"mappings":"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"}