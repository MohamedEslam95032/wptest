{"version":3,"file":"media-edit-view-DrqnnR4N.js","sources":["../../src/components/utility/image-editor/src/filters.js","../../src/components/utility/image-editor/src/transform.js","../../src/components/utility/image-editor/src/history.js","../../src/components/utility/image-editor/src/resize.js","../../src/components/utility/image-editor/src/imageLoader.js","../../src/components/utility/image-editor/src/export.js","../../src/components/utility/image-editor/src/canvas.js","../../src/components/utility/image-editor/index.vue","../../src/pages/media/src/media-edit-view.vue"],"sourcesContent":["/**\n * Image filter functions\n * Pure functions for applying various image filters\n */\n\n/**\n * Apply sharpening filter using unsharp mask algorithm\n * @param {ImageData} imageData - The image data to sharpen\n * @param {number} amount - Sharpening amount (0-100)\n * @returns {ImageData} Sharpened image data\n */\nexport const applySharpening = (imageData, amount) => {\n  if (amount <= 0) return imageData;\n\n  const data = imageData.data;\n  const width = imageData.width;\n  const height = imageData.height;\n  const output = new ImageData(new Uint8ClampedArray(data), width, height);\n  const outputData = output.data;\n\n  // Unsharp mask: subtract blurred version from original\n  const kernel = [0, -1, 0, -1, 5, -1, 0, -1, 0];\n\n  const strength = amount / 100;\n\n  for (let y = 1; y < height - 1; y++) {\n    for (let x = 1; x < width - 1; x++) {\n      let r = 0,\n        g = 0,\n        b = 0;\n\n      for (let ky = -1; ky <= 1; ky++) {\n        for (let kx = -1; kx <= 1; kx++) {\n          const idx = ((y + ky) * width + (x + kx)) * 4;\n          const k = kernel[(ky + 1) * 3 + (kx + 1)];\n          r += data[idx] * k;\n          g += data[idx + 1] * k;\n          b += data[idx + 2] * k;\n        }\n      }\n\n      const idx = (y * width + x) * 4;\n      outputData[idx] = Math.max(\n        0,\n        Math.min(255, data[idx] + (r - data[idx]) * strength)\n      );\n      outputData[idx + 1] = Math.max(\n        0,\n        Math.min(255, data[idx + 1] + (g - data[idx + 1]) * strength)\n      );\n      outputData[idx + 2] = Math.max(\n        0,\n        Math.min(255, data[idx + 2] + (b - data[idx + 2]) * strength)\n      );\n      outputData[idx + 3] = data[idx + 3];\n    }\n  }\n\n  return output;\n};\n\n/**\n * Apply grain/noise effect\n * @param {ImageData} imageData - The image data to add grain to\n * @param {number} amount - Grain amount (0-100)\n * @returns {ImageData} Image data with grain applied\n */\nexport const applyGrain = (imageData, amount) => {\n  if (amount <= 0) return imageData;\n\n  const data = imageData.data;\n  const width = imageData.width;\n  const height = imageData.height;\n  const output = new ImageData(new Uint8ClampedArray(data), width, height);\n  const outputData = output.data;\n\n  const intensity = amount / 100;\n  const grainAmount = intensity * 30; // Max 30 pixel variation\n\n  for (let i = 0; i < data.length; i += 4) {\n    // Generate random grain value (-1 to 1)\n    const grain = (Math.random() * 2 - 1) * grainAmount;\n\n    outputData[i] = Math.max(0, Math.min(255, data[i] + grain));\n    outputData[i + 1] = Math.max(0, Math.min(255, data[i + 1] + grain));\n    outputData[i + 2] = Math.max(0, Math.min(255, data[i + 2] + grain));\n    outputData[i + 3] = data[i + 3]; // Preserve alpha\n  }\n\n  return output;\n};\n\n/**\n * Apply blur filter using box blur\n * @param {ImageData} imageData - The image data to blur\n * @param {number} radius - Blur radius\n * @returns {ImageData} Blurred image data\n */\nexport const applyBlur = (imageData, radius) => {\n  if (radius <= 0) return imageData;\n\n  const data = imageData.data;\n  const width = imageData.width;\n  const height = imageData.height;\n  const output = new ImageData(new Uint8ClampedArray(data), width, height);\n  const outputData = output.data;\n\n  const r = Math.ceil(radius);\n\n  // Horizontal blur\n  for (let y = 0; y < height; y++) {\n    for (let x = 0; x < width; x++) {\n      let rSum = 0,\n        gSum = 0,\n        bSum = 0,\n        count = 0;\n\n      for (let dx = -r; dx <= r; dx++) {\n        const px = Math.max(0, Math.min(width - 1, x + dx));\n        const idx = (y * width + px) * 4;\n        rSum += data[idx];\n        gSum += data[idx + 1];\n        bSum += data[idx + 2];\n        count++;\n      }\n\n      const idx = (y * width + x) * 4;\n      outputData[idx] = rSum / count;\n      outputData[idx + 1] = gSum / count;\n      outputData[idx + 2] = bSum / count;\n    }\n  }\n\n  // Vertical blur\n  const tempData = new Uint8ClampedArray(outputData);\n  for (let y = 0; y < height; y++) {\n    for (let x = 0; x < width; x++) {\n      let rSum = 0,\n        gSum = 0,\n        bSum = 0,\n        count = 0;\n\n      for (let dy = -r; dy <= r; dy++) {\n        const py = Math.max(0, Math.min(height - 1, y + dy));\n        const idx = (py * width + x) * 4;\n        rSum += tempData[idx];\n        gSum += tempData[idx + 1];\n        bSum += tempData[idx + 2];\n        count++;\n      }\n\n      const idx = (y * width + x) * 4;\n      outputData[idx] = rSum / count;\n      outputData[idx + 1] = gSum / count;\n      outputData[idx + 2] = bSum / count;\n    }\n  }\n\n  return output;\n};\n\n/**\n * Apply vibrance (saturation that preserves skin tones)\n * @param {number} r - Red channel value\n * @param {number} g - Green channel value\n * @param {number} b - Blue channel value\n * @param {number} vibranceVal - Vibrance amount (-100 to 100)\n * @returns {{r: number, g: number, b: number}} Adjusted RGB values\n */\nexport const applyVibrance = (r, g, b, vibranceVal) => {\n  if (vibranceVal === 0) return { r, g, b };\n\n  // Calculate saturation\n  const max = Math.max(r, g, b);\n  const min = Math.min(r, g, b);\n  const saturation = max === 0 ? 0 : (max - min) / max;\n\n  // Detect skin tones (warm colors)\n  const isSkinTone = r > 95 && g > 40 && b > 20 && r > g && r > b;\n\n  // Apply less vibrance to skin tones\n  const adjustment = isSkinTone ? vibranceVal * 0.3 : vibranceVal;\n\n  if (saturation > 0) {\n    const gray = 0.299 * r + 0.587 * g + 0.114 * b;\n    const vibranceFactor = 1 + adjustment / 100;\n    r = gray + vibranceFactor * (r - gray);\n    g = gray + vibranceFactor * (g - gray);\n    b = gray + vibranceFactor * (b - gray);\n  }\n\n  return { r, g, b };\n};\n\n/**\n * Apply all filters to canvas pixels (for export)\n * @param {HTMLCanvasElement} canvas - The canvas to apply filters to\n * @param {Object} filterValues - Object containing all filter values\n * @returns {void}\n */\nexport const applyFiltersToCanvas = (canvas, filterValues) => {\n  const {\n    brightness,\n    contrast,\n    saturation,\n    hue,\n    exposure,\n    vibrance,\n    sharpness,\n    highlights,\n    shadows,\n    temperature,\n    tint,\n    blur,\n    grain,\n    vignette,\n  } = filterValues;\n\n  // Skip filter application if all values are at default (0)\n  if (\n    brightness === 0 &&\n    contrast === 0 &&\n    saturation === 0 &&\n    hue === 0 &&\n    exposure === 0 &&\n    vibrance === 0 &&\n    sharpness === 0 &&\n    highlights === 0 &&\n    shadows === 0 &&\n    temperature === 0 &&\n    tint === 0 &&\n    blur === 0 &&\n    grain === 0\n  ) {\n    return; // No filters to apply\n  }\n\n  const ctx = canvas.getContext('2d');\n  let imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n\n  // Apply blur first if needed (before other filters)\n  if (blur > 0) {\n    imageData = applyBlur(imageData, blur / 10);\n    const tempCanvas = document.createElement('canvas');\n    tempCanvas.width = canvas.width;\n    tempCanvas.height = canvas.height;\n    const tempCtx = tempCanvas.getContext('2d');\n    tempCtx.putImageData(imageData, 0, 0);\n    imageData = tempCtx.getImageData(0, 0, canvas.width, canvas.height);\n  }\n\n  // Apply sharpness blur if needed (negative sharpness = blur)\n  if (sharpness < 0) {\n    imageData = applyBlur(imageData, Math.abs(sharpness) / 10);\n    const tempCanvas = document.createElement('canvas');\n    tempCanvas.width = canvas.width;\n    tempCanvas.height = canvas.height;\n    const tempCtx = tempCanvas.getContext('2d');\n    tempCtx.putImageData(imageData, 0, 0);\n    imageData = tempCtx.getImageData(0, 0, canvas.width, canvas.height);\n  }\n\n  const data = imageData.data;\n\n  const brightnessVal = brightness / 100;\n  const exposureVal = exposure / 100;\n  const contrastVal = contrast / 100;\n  // Saturation: 0 = no change (normal), -100 = grayscale, 100 = oversaturated\n  const saturationVal = 1 + saturation / 100;\n  const vibranceVal = vibrance;\n  const hueVal = (hue * Math.PI) / 180;\n  const highlightsVal = highlights / 100;\n  const shadowsVal = shadows / 100;\n  const temperatureVal = temperature / 100; // -1 to 1 (cool to warm)\n  const tintVal = tint / 100; // -1 to 1 (green to magenta)\n\n  for (let i = 0; i < data.length; i += 4) {\n    let r = data[i];\n    let g = data[i + 1];\n    let b = data[i + 2];\n\n    // Calculate luminance for highlights/shadows\n    const luminance = 0.299 * r + 0.587 * g + 0.114 * b;\n\n    // Apply highlights (brighten bright areas)\n    if (highlightsVal !== 0 && luminance > 128) {\n      const highlightAmount = ((luminance - 128) / 127) * highlightsVal;\n      r += highlightAmount * 255;\n      g += highlightAmount * 255;\n      b += highlightAmount * 255;\n    }\n\n    // Apply shadows (darken dark areas)\n    if (shadowsVal !== 0 && luminance < 128) {\n      const shadowAmount = (1 - luminance / 127) * shadowsVal;\n      r -= shadowAmount * 255;\n      g -= shadowAmount * 255;\n      b -= shadowAmount * 255;\n    }\n\n    // Apply brightness and exposure (combined)\n    const totalBrightness = brightnessVal + exposureVal;\n    if (totalBrightness !== 0) {\n      r += totalBrightness * 255;\n      g += totalBrightness * 255;\n      b += totalBrightness * 255;\n    }\n\n    // Apply contrast (with exposure influence)\n    const totalContrast = contrastVal + exposureVal * 0.5;\n    if (totalContrast !== 0) {\n      const factor =\n        (259 * (totalContrast * 255 + 255)) /\n        (255 * (259 - totalContrast * 255));\n      r = factor * (r - 128) + 128;\n      g = factor * (g - 128) + 128;\n      b = factor * (b - 128) + 128;\n    }\n\n    // Apply temperature (cool/warm)\n    if (temperatureVal !== 0) {\n      if (temperatureVal > 0) {\n        // Warm (add red/yellow)\n        r += temperatureVal * 20;\n        g += temperatureVal * 10;\n      } else {\n        // Cool (add blue)\n        b += Math.abs(temperatureVal) * 20;\n        g += Math.abs(temperatureVal) * 5;\n      }\n    }\n\n    // Apply tint (green/magenta)\n    if (tintVal !== 0) {\n      if (tintVal > 0) {\n        // Magenta (add red and blue)\n        r += tintVal * 15;\n        b += tintVal * 15;\n      } else {\n        // Green (add green)\n        g += Math.abs(tintVal) * 20;\n      }\n    }\n\n    // Apply saturation (only if not 1, which means no change)\n    if (saturationVal !== 1) {\n      const gray = 0.299 * r + 0.587 * g + 0.114 * b;\n      r = gray + saturationVal * (r - gray);\n      g = gray + saturationVal * (g - gray);\n      b = gray + saturationVal * (b - gray);\n    }\n\n    // Apply vibrance (preserves skin tones)\n    if (vibranceVal !== 0) {\n      const vibranced = applyVibrance(r, g, b, vibranceVal);\n      r = vibranced.r;\n      g = vibranced.g;\n      b = vibranced.b;\n    }\n\n    // Apply hue rotation (only if non-zero)\n    if (hueVal !== 0) {\n      const cos = Math.cos(hueVal);\n      const sin = Math.sin(hueVal);\n      const newR =\n        r * (cos + (1 - cos) / 3) +\n        g * ((1 - cos) / 3 - (Math.sqrt(3) * sin) / 3) +\n        b * ((1 - cos) / 3 + (Math.sqrt(3) * sin) / 3);\n      const newG =\n        r * ((1 - cos) / 3 + (Math.sqrt(3) * sin) / 3) +\n        g * (cos + (1 - cos) / 3) +\n        b * ((1 - cos) / 3 - (Math.sqrt(3) * sin) / 3);\n      const newB =\n        r * ((1 - cos) / 3 - (Math.sqrt(3) * sin) / 3) +\n        g * ((1 - cos) / 3 + (Math.sqrt(3) * sin) / 3) +\n        b * (cos + (1 - cos) / 3);\n      r = newR;\n      g = newG;\n      b = newB;\n    }\n\n    data[i] = Math.max(0, Math.min(255, r));\n    data[i + 1] = Math.max(0, Math.min(255, g));\n    data[i + 2] = Math.max(0, Math.min(255, b));\n  }\n\n  ctx.putImageData(imageData, 0, 0);\n\n  // Apply sharpening last (after all other filters)\n  if (sharpness > 0) {\n    const sharpenedData = applySharpening(imageData, sharpness);\n    ctx.putImageData(sharpenedData, 0, 0);\n  }\n\n  // Apply grain last (after all other filters)\n  if (grain > 0) {\n    const grainedData = applyGrain(imageData, grain);\n    ctx.putImageData(grainedData, 0, 0);\n  }\n\n  // Apply vignette overlay\n  if (vignette > 0) {\n    const centerX = canvas.width / 2;\n    const centerY = canvas.height / 2;\n    const maxRadius = Math.sqrt(centerX * centerX + centerY * centerY);\n    const intensity = vignette / 100;\n\n    const gradient = ctx.createRadialGradient(\n      centerX,\n      centerY,\n      0,\n      centerX,\n      centerY,\n      maxRadius\n    );\n\n    gradient.addColorStop(0, 'rgba(0, 0, 0, 0)');\n    gradient.addColorStop(1, `rgba(0, 0, 0, ${intensity * 0.8})`);\n\n    ctx.fillStyle = gradient;\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\n  }\n};\n\n/**\n * Apply filters for preview (using pixel manipulation for accurate preview)\n * @param {HTMLCanvasElement} canvas - The canvas element\n * @param {HTMLImageElement} currentImage - The current image element\n * @param {Object} filterValues - Object containing all filter values\n * @returns {void}\n */\nexport const applyCSSFilters = (canvas, currentImage, filterValues) => {\n  if (!canvas || !currentImage) return;\n\n  const {\n    brightness,\n    contrast,\n    saturation,\n    hue,\n    exposure,\n    vibrance,\n    sharpness,\n    highlights,\n    shadows,\n    temperature,\n    tint,\n    blur,\n    grain,\n  } = filterValues;\n\n  // Skip if all filters are at default\n  if (\n    brightness === 0 &&\n    contrast === 0 &&\n    saturation === 0 &&\n    hue === 0 &&\n    exposure === 0 &&\n    vibrance === 0 &&\n    sharpness === 0 &&\n    highlights === 0 &&\n    shadows === 0 &&\n    temperature === 0 &&\n    tint === 0 &&\n    blur === 0 &&\n    grain === 0\n  ) {\n    return;\n  }\n\n  const ctx = canvas.getContext('2d');\n\n  // Get current image data from canvas\n  let imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n\n  // Apply blur first if needed (before other filters)\n  if (blur > 0) {\n    imageData = applyBlur(imageData, blur / 10);\n    const tempCanvas = document.createElement('canvas');\n    tempCanvas.width = canvas.width;\n    tempCanvas.height = canvas.height;\n    const tempCtx = tempCanvas.getContext('2d');\n    tempCtx.putImageData(imageData, 0, 0);\n    imageData = tempCtx.getImageData(0, 0, canvas.width, canvas.height);\n  }\n\n  // Apply sharpness blur if needed (negative sharpness = blur)\n  if (sharpness < 0) {\n    imageData = applyBlur(imageData, Math.abs(sharpness) / 10);\n    const tempCanvas = document.createElement('canvas');\n    tempCanvas.width = canvas.width;\n    tempCanvas.height = canvas.height;\n    const tempCtx = tempCanvas.getContext('2d');\n    tempCtx.putImageData(imageData, 0, 0);\n    imageData = tempCtx.getImageData(0, 0, canvas.width, canvas.height);\n  }\n\n  const data = imageData.data;\n\n  const brightnessVal = brightness / 100;\n  const exposureVal = exposure / 100;\n  const contrastVal = contrast / 100;\n  const saturationVal = 1 + saturation / 100;\n  const vibranceVal = vibrance;\n  const hueVal = (hue * Math.PI) / 180;\n  const highlightsVal = highlights / 100;\n  const shadowsVal = shadows / 100;\n  const temperatureVal = temperature / 100;\n  const tintVal = tint / 100;\n\n  for (let i = 0; i < data.length; i += 4) {\n    let r = data[i];\n    let g = data[i + 1];\n    let b = data[i + 2];\n\n    // Calculate luminance for highlights/shadows\n    const luminance = 0.299 * r + 0.587 * g + 0.114 * b;\n\n    // Apply highlights (brighten bright areas)\n    if (highlightsVal !== 0 && luminance > 128) {\n      const highlightAmount = ((luminance - 128) / 127) * highlightsVal;\n      r += highlightAmount * 255;\n      g += highlightAmount * 255;\n      b += highlightAmount * 255;\n    }\n\n    // Apply shadows (darken dark areas)\n    if (shadowsVal !== 0 && luminance < 128) {\n      const shadowAmount = (1 - luminance / 127) * shadowsVal;\n      r -= shadowAmount * 255;\n      g -= shadowAmount * 255;\n      b -= shadowAmount * 255;\n    }\n\n    // Apply brightness and exposure (combined)\n    const totalBrightness = brightnessVal + exposureVal;\n    if (totalBrightness !== 0) {\n      r += totalBrightness * 255;\n      g += totalBrightness * 255;\n      b += totalBrightness * 255;\n    }\n\n    // Apply contrast (with exposure influence)\n    const totalContrast = contrastVal + exposureVal * 0.5;\n    if (totalContrast !== 0) {\n      const factor =\n        (259 * (totalContrast * 255 + 255)) /\n        (255 * (259 - totalContrast * 255));\n      r = factor * (r - 128) + 128;\n      g = factor * (g - 128) + 128;\n      b = factor * (b - 128) + 128;\n    }\n\n    // Apply temperature (cool/warm)\n    if (temperatureVal !== 0) {\n      if (temperatureVal > 0) {\n        // Warm (add red/yellow)\n        r += temperatureVal * 20;\n        g += temperatureVal * 10;\n      } else {\n        // Cool (add blue)\n        b += Math.abs(temperatureVal) * 20;\n        g += Math.abs(temperatureVal) * 5;\n      }\n    }\n\n    // Apply tint (green/magenta)\n    if (tintVal !== 0) {\n      if (tintVal > 0) {\n        // Magenta (add red and blue)\n        r += tintVal * 15;\n        b += tintVal * 15;\n      } else {\n        // Green (add green)\n        g += Math.abs(tintVal) * 20;\n      }\n    }\n\n    // Apply saturation (only if not 1, which means no change)\n    if (saturationVal !== 1) {\n      const gray = 0.299 * r + 0.587 * g + 0.114 * b;\n      r = gray + saturationVal * (r - gray);\n      g = gray + saturationVal * (g - gray);\n      b = gray + saturationVal * (b - gray);\n    }\n\n    // Apply vibrance (preserves skin tones)\n    if (vibranceVal !== 0) {\n      const vibranced = applyVibrance(r, g, b, vibranceVal);\n      r = vibranced.r;\n      g = vibranced.g;\n      b = vibranced.b;\n    }\n\n    // Apply hue rotation (only if non-zero)\n    if (hueVal !== 0) {\n      const cos = Math.cos(hueVal);\n      const sin = Math.sin(hueVal);\n      const newR =\n        r * (cos + (1 - cos) / 3) +\n        g * ((1 - cos) / 3 - (Math.sqrt(3) * sin) / 3) +\n        b * ((1 - cos) / 3 + (Math.sqrt(3) * sin) / 3);\n      const newG =\n        r * ((1 - cos) / 3 + (Math.sqrt(3) * sin) / 3) +\n        g * (cos + (1 - cos) / 3) +\n        b * ((1 - cos) / 3 - (Math.sqrt(3) * sin) / 3);\n      const newB =\n        r * ((1 - cos) / 3 - (Math.sqrt(3) * sin) / 3) +\n        g * ((1 - cos) / 3 + (Math.sqrt(3) * sin) / 3) +\n        b * (cos + (1 - cos) / 3);\n      r = newR;\n      g = newG;\n      b = newB;\n    }\n\n    data[i] = Math.max(0, Math.min(255, r));\n    data[i + 1] = Math.max(0, Math.min(255, g));\n    data[i + 2] = Math.max(0, Math.min(255, b));\n  }\n\n  ctx.putImageData(imageData, 0, 0);\n\n  // Apply sharpening last (after all other filters)\n  if (sharpness > 0) {\n    const sharpenedData = applySharpening(imageData, sharpness);\n    ctx.putImageData(sharpenedData, 0, 0);\n  }\n\n  // Apply grain last (after all other filters)\n  if (grain > 0) {\n    const grainedData = applyGrain(imageData, grain);\n    ctx.putImageData(grainedData, 0, 0);\n  }\n};\n\n","/**\n * Transform functions for image editing\n * Functions for rotating and flipping images\n */\n\n/**\n * Rotate image by specified degrees\n * @param {Object} state - State object containing rotation ref\n * @param {number} degrees - Degrees to rotate (positive = clockwise)\n * @param {Function} drawImage - Function to redraw the image after rotation\n * @returns {void}\n */\nexport const rotateImage = (state, degrees, drawImage) => {\n  state.rotation.value = (state.rotation.value + degrees) % 360;\n  drawImage();\n};\n\n/**\n * Flip image horizontally\n * @param {Object} state - State object containing flipHorizontal ref\n * @param {Function} drawImage - Function to redraw the image after flip\n * @returns {void}\n */\nexport const flipImageHorizontal = (state, drawImage) => {\n  state.flipHorizontal.value = !state.flipHorizontal.value;\n  drawImage();\n};\n\n/**\n * Flip image vertically\n * @param {Object} state - State object containing flipVertical ref\n * @param {Function} drawImage - Function to redraw the image after flip\n * @returns {void}\n */\nexport const flipImageVertical = (state, drawImage) => {\n  state.flipVertical.value = !state.flipVertical.value;\n  drawImage();\n};\n\n/**\n * Reset all transformations\n * @param {Object} state - State object containing transformation refs\n * @param {Function} drawImage - Function to redraw the image after reset\n * @returns {void}\n */\nexport const resetTransformations = (state, drawImage) => {\n  state.rotation.value = 0;\n  state.flipHorizontal.value = false;\n  state.flipVertical.value = false;\n  drawImage();\n};\n\n","/**\n * History management functions for undo/redo\n * Functions for managing edit history and state restoration\n */\n\n/**\n * Save current state to history\n * @param {Object} state - State object containing all editor state refs\n * @param {Object} history - History array ref\n * @param {Object} historyIndex - History index ref\n * @param {number} maxHistorySize - Maximum history size\n * @param {HTMLImageElement} currentImage - Current image element (for saving imageData)\n * @returns {void}\n */\nexport const saveToHistory = (\n  state,\n  history,\n  historyIndex,\n  maxHistorySize,\n  currentImage\n) => {\n  const historyState = {\n    brightness: state.brightness.value,\n    contrast: state.contrast.value,\n    saturation: state.saturation.value,\n    hue: state.hue.value,\n    exposure: state.exposure.value,\n    vibrance: state.vibrance.value,\n    sharpness: state.sharpness.value,\n    highlights: state.highlights.value,\n    shadows: state.shadows.value,\n    temperature: state.temperature.value,\n    tint: state.tint.value,\n    vignette: state.vignette.value,\n    blur: state.blur.value,\n    grain: state.grain.value,\n    rotation: state.rotation.value,\n    flipHorizontal: state.flipHorizontal.value,\n    flipVertical: state.flipVertical.value,\n    imageWidth: state.imageWidth.value,\n    imageHeight: state.imageHeight.value,\n    imageData: currentImage ? currentImage.src : null,\n  };\n\n  // Remove any states after current index (when undoing then making new changes)\n  if (historyIndex.value < history.value.length - 1) {\n    history.value = history.value.slice(0, historyIndex.value + 1);\n  }\n\n  // Add new state\n  history.value.push(historyState);\n  historyIndex.value = history.value.length - 1;\n\n  // Limit history size\n  if (history.value.length > maxHistorySize) {\n    history.value.shift();\n    historyIndex.value--;\n  }\n};\n\n/**\n * Restore state from history\n * @param {Object} state - State object containing all editor state refs\n * @param {Object} historyState - The state to restore\n * @param {Function} nextTick - Vue's nextTick function\n * @param {Function} initializeCanvas - Function to reinitialize canvas\n * @param {Object} currentImage - Current image ref (for image restoration)\n * @returns {Promise<void>}\n */\nexport const restoreState = async (\n  state,\n  historyState,\n  nextTick,\n  initializeCanvas,\n  currentImage\n) => {\n  state.brightness.value = historyState.brightness;\n  state.contrast.value = historyState.contrast;\n  state.saturation.value = historyState.saturation;\n  state.hue.value = historyState.hue;\n  state.exposure.value = historyState.exposure;\n  state.vibrance.value = historyState.vibrance;\n  state.sharpness.value = historyState.sharpness;\n  state.highlights.value = historyState.highlights || 0;\n  state.shadows.value = historyState.shadows || 0;\n  state.temperature.value = historyState.temperature || 0;\n  state.tint.value = historyState.tint || 0;\n  state.vignette.value = historyState.vignette || 0;\n  state.blur.value = historyState.blur || 0;\n  state.grain.value = historyState.grain || 0;\n  state.rotation.value = historyState.rotation;\n  state.flipHorizontal.value = historyState.flipHorizontal;\n  state.flipVertical.value = historyState.flipVertical;\n  state.imageWidth.value = historyState.imageWidth;\n  state.imageHeight.value = historyState.imageHeight;\n\n  // Restore image if imageData changed\n  if (historyState.imageData && historyState.imageData !== currentImage.value?.src) {\n    const img = new Image();\n    img.crossOrigin = 'anonymous';\n    await new Promise((resolve, reject) => {\n      img.onload = () => {\n        currentImage.value = img;\n        resolve();\n      };\n      img.onerror = reject;\n      img.src = historyState.imageData;\n    });\n  }\n\n  await nextTick();\n  initializeCanvas();\n};\n\n/**\n * Undo last action\n * @param {Object} history - History array ref\n * @param {Object} historyIndex - History index ref\n * @param {Object} state - State object containing all editor state refs\n * @param {Function} nextTick - Vue's nextTick function\n * @param {Function} initializeCanvas - Function to reinitialize canvas\n * @param {Object} currentImage - Current image ref\n * @returns {Promise<void>}\n */\nexport const undo = async (\n  history,\n  historyIndex,\n  state,\n  nextTick,\n  initializeCanvas,\n  currentImage\n) => {\n  if (historyIndex.value <= 0) return; // Can't undo past initial state\n\n  historyIndex.value--;\n  const previousState = history.value[historyIndex.value];\n  await restoreState(state, previousState, nextTick, initializeCanvas, currentImage);\n};\n\n/**\n * Redo last undone action\n * @param {Object} history - History array ref\n * @param {Object} historyIndex - History index ref\n * @param {Object} state - State object containing all editor state refs\n * @param {Function} nextTick - Vue's nextTick function\n * @param {Function} initializeCanvas - Function to reinitialize canvas\n * @param {Object} currentImage - Current image ref\n * @returns {Promise<void>}\n */\nexport const redo = async (\n  history,\n  historyIndex,\n  state,\n  nextTick,\n  initializeCanvas,\n  currentImage\n) => {\n  if (historyIndex.value >= history.value.length - 1) return;\n\n  historyIndex.value++;\n  const nextState = history.value[historyIndex.value];\n  await restoreState(state, nextState, nextTick, initializeCanvas, currentImage);\n};\n\n","/**\n * Resize functions for image editing\n * Functions for resizing images while maintaining aspect ratio\n */\n\n/**\n * Handle resize width change\n * @param {Object} state - State object containing resize-related refs\n * @returns {void}\n */\nexport const handleResizeWidthChange = (state) => {\n  if (state.lockAspectRatio.value && state.originalAspectRatio.value > 0) {\n    state.resizeHeight.value = Math.round(\n      state.resizeWidth.value / state.originalAspectRatio.value\n    );\n  }\n};\n\n/**\n * Handle resize height change\n * @param {Object} state - State object containing resize-related refs\n * @returns {void}\n */\nexport const handleResizeHeightChange = (state) => {\n  if (state.lockAspectRatio.value && state.originalAspectRatio.value > 0) {\n    state.resizeWidth.value = Math.round(\n      state.resizeHeight.value * state.originalAspectRatio.value\n    );\n  }\n};\n\n/**\n * Apply resize to image\n * @param {Object} state - State object containing image and resize-related refs\n * @param {Function} nextTick - Vue's nextTick function\n * @param {Function} initializeCanvas - Function to reinitialize canvas\n * @param {Function} saveToHistory - Function to save state to history\n * @returns {Promise<void>}\n */\nexport const applyResize = async (\n  state,\n  nextTick,\n  initializeCanvas,\n  saveToHistory\n) => {\n  if (\n    !state.currentImage.value ||\n    state.resizeWidth.value <= 0 ||\n    state.resizeHeight.value <= 0\n  )\n    return;\n\n  const canvas = document.createElement('canvas');\n  canvas.width = state.resizeWidth.value;\n  canvas.height = state.resizeHeight.value;\n  const ctx = canvas.getContext('2d');\n\n  // Use high-quality image scaling\n  ctx.imageSmoothingEnabled = true;\n  ctx.imageSmoothingQuality = 'high';\n\n  ctx.drawImage(\n    state.currentImage.value,\n    0,\n    0,\n    state.resizeWidth.value,\n    state.resizeHeight.value\n  );\n\n  const img = new Image();\n  img.crossOrigin = 'anonymous';\n  await new Promise((resolve, reject) => {\n    img.onload = () => {\n      state.currentImage.value = img;\n      state.imageWidth.value = img.width;\n      state.imageHeight.value = img.height;\n      state.originalAspectRatio.value = img.width / img.height;\n      resolve();\n    };\n    img.onerror = reject;\n    img.src = canvas.toDataURL('image/png');\n  });\n\n  await nextTick();\n  initializeCanvas();\n  saveToHistory();\n};\n\n","/**\n * Image loader functions\n * Functions for loading and initializing images\n */\n\n/**\n * Load image from URL\n * @param {string} src - Image source URL\n * @param {Object} state - State object containing image-related refs\n * @param {Function} nextTick - Vue's nextTick function\n * @param {Function} initializeCanvas - Function to initialize canvas after image loads\n * @param {Function} saveToHistory - Function to save initial state to history\n * @returns {Promise<void>}\n */\nexport const loadImage = async (\n  src,\n  state,\n  nextTick,\n  initializeCanvas,\n  saveToHistory\n) => {\n  state.loading.value = true;\n  state.imageLoaded.value = false;\n\n  const img = new Image();\n  img.crossOrigin = 'anonymous';\n\n  await new Promise((resolve, reject) => {\n    img.onload = () => {\n      state.originalImage.value = img;\n      state.currentImage.value = img;\n      state.imageWidth.value = img.width;\n      state.imageHeight.value = img.height;\n      state.resizeWidth.value = img.width;\n      state.resizeHeight.value = img.height;\n      state.originalAspectRatio.value = img.width / img.height;\n      state.imageLoaded.value = true;\n      state.loading.value = false;\n      resolve();\n    };\n    img.onerror = () => {\n      state.loading.value = false;\n      reject(new Error('Failed to load image'));\n    };\n    img.src = src;\n  });\n\n  await nextTick();\n  initializeCanvas();\n  saveToHistory();\n};\n\n/**\n * Initialize canvas with proper dimensions\n * @param {HTMLCanvasElement} canvasRef - Reference to canvas element\n * @param {HTMLElement} containerRef - Reference to container element\n * @param {Object} state - State object containing image dimensions and scale refs\n * @param {Function} drawImage - Function to draw the image\n * @returns {void}\n */\nexport const initializeCanvas = (\n  canvasRef,\n  containerRef,\n  state,\n  drawImage\n) => {\n  if (!canvasRef || !state.currentImage.value) return;\n\n  const canvas = canvasRef;\n  const container = containerRef;\n\n  if (!container) return;\n\n  // Calculate container dimensions\n  const containerWidth = container.clientWidth;\n  const containerHeight = container.clientHeight;\n\n  // Calculate scale to fit image in container\n  const imageAspect = state.imageWidth.value / state.imageHeight.value;\n  const containerAspect = containerWidth / containerHeight;\n\n  let displayWidth, displayHeight;\n\n  if (imageAspect > containerAspect) {\n    displayWidth = Math.min(containerWidth - 40, state.imageWidth.value);\n    displayHeight = displayWidth / imageAspect;\n  } else {\n    displayHeight = Math.min(containerHeight - 40, state.imageHeight.value);\n    displayWidth = displayHeight * imageAspect;\n  }\n\n  // Set canvas size\n  canvas.width = displayWidth;\n  canvas.height = displayHeight;\n\n  state.scale.value = displayWidth / state.imageWidth.value;\n\n  drawImage();\n};\n\n","/**\n * Export functions for image editing\n * Functions for exporting edited images\n */\n\nimport { applyFiltersToCanvas } from './filters.js';\n\n/**\n * Export edited image\n * @param {Object} state - State object containing all editor state refs\n * @param {HTMLCanvasElement} canvasRef - Reference to the canvas element\n * @returns {string|null} Data URL of the exported image, or null if export fails\n */\nexport const exportImage = (state, canvasRef) => {\n  if (!canvasRef || !state.currentImage.value) return null;\n\n  // Use resize dimensions if they differ from current image dimensions\n  const exportWidth =\n    state.resizeWidth.value > 0 &&\n    state.resizeWidth.value !== state.imageWidth.value\n      ? state.resizeWidth.value\n      : state.imageWidth.value;\n  const exportHeight =\n    state.resizeHeight.value > 0 &&\n    state.resizeHeight.value !== state.imageHeight.value\n      ? state.resizeHeight.value\n      : state.imageHeight.value;\n\n  // Create a new canvas with the export dimensions\n  const exportCanvas = document.createElement('canvas');\n  exportCanvas.width = exportWidth;\n  exportCanvas.height = exportHeight;\n  const exportCtx = exportCanvas.getContext('2d');\n\n  // Use high-quality scaling\n  exportCtx.imageSmoothingEnabled = true;\n  exportCtx.imageSmoothingQuality = 'high';\n\n  // Apply transformations\n  exportCtx.save();\n  exportCtx.translate(exportCanvas.width / 2, exportCanvas.height / 2);\n  exportCtx.rotate((state.rotation.value * Math.PI) / 180);\n\n  if (state.flipHorizontal.value) {\n    exportCtx.scale(-1, 1);\n  }\n  if (state.flipVertical.value) {\n    exportCtx.scale(1, -1);\n  }\n\n  // Draw image\n  exportCtx.drawImage(\n    state.currentImage.value,\n    -exportCanvas.width / 2,\n    -exportCanvas.height / 2,\n    exportCanvas.width,\n    exportCanvas.height\n  );\n\n  exportCtx.restore();\n\n  // Apply color filters\n  const filterValues = {\n    brightness: state.brightness.value,\n    contrast: state.contrast.value,\n    saturation: state.saturation.value,\n    hue: state.hue.value,\n    exposure: state.exposure.value,\n    vibrance: state.vibrance.value,\n    sharpness: state.sharpness.value,\n    highlights: state.highlights.value,\n    shadows: state.shadows.value,\n    temperature: state.temperature.value,\n    tint: state.tint.value,\n    vignette: state.vignette.value,\n    blur: state.blur.value,\n    grain: state.grain.value,\n  };\n\n  applyFiltersToCanvas(exportCanvas, filterValues);\n\n  return exportCanvas.toDataURL('image/jpeg', 0.92);\n};\n\n","/**\n * Canvas drawing utility functions\n * Functions for drawing overlays and effects on canvas\n */\n\n/**\n * Draw vignette effect on canvas\n * @param {CanvasRenderingContext2D} ctx - Canvas rendering context\n * @param {HTMLCanvasElement} canvas - Canvas element\n * @param {number} vignetteValue - Vignette intensity (0-100)\n * @returns {void}\n */\nexport const drawVignette = (ctx, canvas, vignetteValue) => {\n  if (!canvas || vignetteValue <= 0) return;\n\n  const centerX = canvas.width / 2;\n  const centerY = canvas.height / 2;\n  const maxRadius = Math.sqrt(centerX * centerX + centerY * centerY);\n  const intensity = vignetteValue / 100;\n\n  // Create radial gradient\n  const gradient = ctx.createRadialGradient(\n    centerX,\n    centerY,\n    0,\n    centerX,\n    centerY,\n    maxRadius\n  );\n\n  gradient.addColorStop(0, 'rgba(0, 0, 0, 0)');\n  gradient.addColorStop(1, `rgba(0, 0, 0, ${intensity * 0.8})`);\n\n  ctx.fillStyle = gradient;\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\n};\n\n/**\n * Draw crop overlay on canvas\n * @param {CanvasRenderingContext2D} ctx - Canvas rendering context\n * @param {HTMLCanvasElement} canvas - Canvas element\n * @param {number} cropStartX - Crop start X coordinate\n * @param {number} cropStartY - Crop start Y coordinate\n * @param {number} cropEndX - Crop end X coordinate\n * @param {number} cropEndY - Crop end Y coordinate\n * @returns {void}\n */\nexport const drawCropOverlay = (\n  ctx,\n  canvas,\n  cropStartX,\n  cropStartY,\n  cropEndX,\n  cropEndY\n) => {\n  if (!canvas) return;\n\n  const x1 = Math.min(cropStartX, cropEndX);\n  const y1 = Math.min(cropStartY, cropEndY);\n  const x2 = Math.max(cropStartX, cropEndX);\n  const y2 = Math.max(cropStartY, cropEndY);\n\n  const width = x2 - x1;\n  const height = y2 - y1;\n\n  // Only draw if there's a valid selection\n  if (width <= 0 || height <= 0) return;\n\n  // Draw dark overlay over entire canvas first\n  ctx.fillStyle = 'rgba(0, 0, 0, 0.6)';\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n  // Clear the crop area (make it bright/visible) - this is what we keep\n  ctx.globalCompositeOperation = 'destination-out';\n  ctx.fillRect(x1, y1, width, height);\n  ctx.globalCompositeOperation = 'source-over';\n\n  // Draw crop border\n  ctx.strokeStyle = '#3b82f6';\n  ctx.lineWidth = 2;\n  ctx.setLineDash([]);\n  ctx.strokeRect(x1, y1, width, height);\n\n  // Draw corner handles\n  const handleSize = 12;\n  ctx.fillStyle = '#3b82f6';\n  ctx.strokeStyle = '#ffffff';\n  ctx.lineWidth = 2;\n\n  // Top-left\n  ctx.fillRect(\n    x1 - handleSize / 2,\n    y1 - handleSize / 2,\n    handleSize,\n    handleSize\n  );\n  ctx.strokeRect(\n    x1 - handleSize / 2,\n    y1 - handleSize / 2,\n    handleSize,\n    handleSize\n  );\n\n  // Top-right\n  ctx.fillRect(\n    x2 - handleSize / 2,\n    y1 - handleSize / 2,\n    handleSize,\n    handleSize\n  );\n  ctx.strokeRect(\n    x2 - handleSize / 2,\n    y1 - handleSize / 2,\n    handleSize,\n    handleSize\n  );\n\n  // Bottom-left\n  ctx.fillRect(\n    x1 - handleSize / 2,\n    y2 - handleSize / 2,\n    handleSize,\n    handleSize\n  );\n  ctx.strokeRect(\n    x1 - handleSize / 2,\n    y2 - handleSize / 2,\n    handleSize,\n    handleSize\n  );\n\n  // Bottom-right\n  ctx.fillRect(\n    x2 - handleSize / 2,\n    y2 - handleSize / 2,\n    handleSize,\n    handleSize\n  );\n  ctx.strokeRect(\n    x2 - handleSize / 2,\n    y2 - handleSize / 2,\n    handleSize,\n    handleSize\n  );\n};\n\n","<script setup>\nimport { ref, computed, onMounted, onUnmounted, watch, nextTick } from 'vue';\nimport AppIcon from '@/components/utility/icons/index.vue';\nimport AppButton from '@/components/utility/app-button/index.vue';\nimport {\n  applyFiltersToCanvas,\n  applyBlur,\n  applySharpening,\n  applyGrain,\n  applyVibrance,\n} from './src/filters.js';\nimport {\n  rotateImage,\n  flipImageHorizontal,\n  flipImageVertical,\n  resetTransformations,\n} from './src/transform.js';\nimport { saveToHistory, undo, redo, restoreState } from './src/history.js';\nimport {\n  handleResizeWidthChange,\n  handleResizeHeightChange,\n  applyResize,\n} from './src/resize.js';\nimport { loadImage, initializeCanvas } from './src/imageLoader.js';\nimport { exportImage } from './src/export.js';\nimport { drawVignette, drawCropOverlay } from './src/canvas.js';\n\n/**\n * Custom Image Editor Component\n *\n * Provides image editing capabilities including:\n * - Cropping\n * - Flip (horizontal/vertical)\n * - Rotate\n * - Color adjustments (brightness, contrast, saturation, hue)\n */\n\nconst props = defineProps({\n  /**\n   * Source image URL\n   */\n  src: {\n    type: String,\n    required: true,\n  },\n  /**\n   * Whether the editor is disabled\n   */\n  disabled: {\n    type: Boolean,\n    default: false,\n  },\n});\n\nconst emit = defineEmits(['save', 'cancel']);\n\n// Canvas and image refs\nconst canvasRef = ref(null);\nconst imageRef = ref(null);\nconst containerRef = ref(null);\nconst imageLoaded = ref(false);\nconst loading = ref(true);\n\n// Image state\nconst originalImage = ref(null);\nconst currentImage = ref(null);\nconst imageWidth = ref(0);\nconst imageHeight = ref(0);\nconst scale = ref(1);\nconst translateX = ref(0);\nconst translateY = ref(0);\n\n// Transformations\nconst rotation = ref(0); // degrees\nconst flipHorizontal = ref(false);\nconst flipVertical = ref(false);\n\n// Color adjustments\nconst brightness = ref(0); // -100 to 100\nconst contrast = ref(0); // -100 to 100\nconst saturation = ref(0); // -100 to 100\nconst hue = ref(0); // -180 to 180\nconst exposure = ref(0); // -100 to 100\nconst vibrance = ref(0); // -100 to 100\nconst sharpness = ref(0); // -100 to 100 (negative = blur, positive = sharpen)\nconst highlights = ref(0); // -100 to 100\nconst shadows = ref(0); // -100 to 100\nconst temperature = ref(0); // -100 to 100 (cool to warm)\nconst tint = ref(0); // -100 to 100 (green to magenta)\nconst vignette = ref(0); // 0 to 100 (0 = no vignette, 100 = maximum)\nconst blur = ref(0); // 0 to 100 (0 = no blur, 100 = maximum blur)\nconst grain = ref(0); // 0 to 100 (0 = no grain, 100 = maximum grain)\n\n// Resize state\nconst resizeWidth = ref(0);\nconst resizeHeight = ref(0);\nconst lockAspectRatio = ref(true);\nconst originalAspectRatio = ref(1);\n\n// Before/After toggle\nconst showOriginal = ref(false);\n\n// History for undo/redo\nconst history = ref([]);\nconst historyIndex = ref(-1);\nconst maxHistorySize = 50;\n\n// Crop state\nconst isCropping = ref(false);\nconst cropStartX = ref(0);\nconst cropStartY = ref(0);\nconst cropEndX = ref(0);\nconst cropEndY = ref(0);\nconst cropActive = ref(false);\nconst isMovingCrop = ref(false);\nconst cropMoveStartX = ref(0);\nconst cropMoveStartY = ref(0);\nconst cropOffsetX = ref(0);\nconst cropOffsetY = ref(0);\nconst buttonPosition = ref({ centerX: 0, centerY: 0 });\nconst showCropButtons = ref(false);\nconst cropAspectRatio = ref(null); // null = free, or a ratio like 1, 16/9, etc.\nconst cropAspectRatioPresets = [\n  { label: __('Free', 'uixpress'), value: null },\n  { label: '1:1', value: 1 },\n  { label: '4:3', value: 4 / 3 },\n  { label: '3:4', value: 3 / 4 },\n  { label: '16:9', value: 16 / 9 },\n  { label: '9:16', value: 9 / 16 },\n  { label: '21:9', value: 21 / 9 },\n  { label: '5:4', value: 5 / 4 },\n  { label: '4:5', value: 4 / 5 },\n];\n\n// UI state\nconst showControls = ref(true);\nconst expandedSections = ref({\n  luminosity: true,\n  color: false,\n  effects: false,\n  transform: false,\n  resize: false,\n  crop: false,\n});\n\n/**\n * Check if there's a valid crop selection\n */\nconst hasValidCropSelection = computed(() => {\n  const x1 = Math.min(cropStartX.value, cropEndX.value);\n  const y1 = Math.min(cropStartY.value, cropEndY.value);\n  const x2 = Math.max(cropStartX.value, cropEndX.value);\n  const y2 = Math.max(cropStartY.value, cropEndY.value);\n  return x2 - x1 > 5 && y2 - y1 > 5;\n});\n\n/**\n * Update button position based on crop area\n */\nconst updateButtonPosition = () => {\n  if (!hasValidCropSelection.value || !canvasRef.value || !containerRef.value) {\n    buttonPosition.value = { centerX: 0, centerY: 0 };\n    return;\n  }\n\n  const canvas = canvasRef.value;\n  const container = containerRef.value;\n\n  // Get bounding rects to calculate actual positions\n  const canvasRect = canvas.getBoundingClientRect();\n  const containerRect = container.getBoundingClientRect();\n\n  // Calculate canvas position relative to container (accounting for scroll)\n  const canvasOffsetX =\n    canvasRect.left - containerRect.left + container.scrollLeft;\n  const canvasOffsetY =\n    canvasRect.top - containerRect.top + container.scrollTop;\n\n  // Get crop area center in canvas coordinates\n  const x1 = Math.min(cropStartX.value, cropEndX.value);\n  const y1 = Math.min(cropStartY.value, cropEndY.value);\n  const x2 = Math.max(cropStartX.value, cropEndX.value);\n  const y2 = Math.max(cropStartY.value, cropEndY.value);\n\n  // Calculate center position relative to container\n  buttonPosition.value = {\n    centerX: canvasOffsetX + x1 + (x2 - x1) / 2,\n    centerY: canvasOffsetY + y1 + (y2 - y1) / 2,\n  };\n};\n\n/**\n * Check if a point is inside the crop area\n */\nconst isPointInCropArea = (x, y) => {\n  if (!hasValidCropSelection.value) return false;\n\n  const x1 = Math.min(cropStartX.value, cropEndX.value);\n  const y1 = Math.min(cropStartY.value, cropEndY.value);\n  const x2 = Math.max(cropStartX.value, cropEndX.value);\n  const y2 = Math.max(cropStartY.value, cropEndY.value);\n\n  return x >= x1 && x <= x2 && y >= y1 && y <= y2;\n};\n\n/**\n * Check if cursor should be crosshair (when cropping)\n */\nconst showCropCursor = computed(() => {\n  if (!isCropping.value) return false;\n  if (cropActive.value) return true;\n  if (isMovingCrop.value) return false; // Will use cursor-move instead\n  return hasValidCropSelection.value;\n});\n\n/**\n * Save current state to history\n */\nconst saveToHistoryWrapper = () => {\n  const state = {\n    brightness,\n    contrast,\n    saturation,\n    hue,\n    exposure,\n    vibrance,\n    sharpness,\n    highlights,\n    shadows,\n    temperature,\n    tint,\n    vignette,\n    blur,\n    grain,\n    rotation,\n    flipHorizontal,\n    flipVertical,\n    imageWidth,\n    imageHeight,\n  };\n  saveToHistory(\n    state,\n    history,\n    historyIndex,\n    maxHistorySize,\n    currentImage.value\n  );\n};\n\n/**\n * Undo last change\n */\nconst undoWrapper = async () => {\n  const state = {\n    brightness,\n    contrast,\n    saturation,\n    hue,\n    exposure,\n    vibrance,\n    sharpness,\n    highlights,\n    shadows,\n    temperature,\n    tint,\n    vignette,\n    blur,\n    grain,\n    rotation,\n    flipHorizontal,\n    flipVertical,\n    imageWidth,\n    imageHeight,\n  };\n  await undo(\n    history,\n    historyIndex,\n    state,\n    nextTick,\n    initializeCanvasWrapper,\n    currentImage\n  );\n};\n\n/**\n * Redo last undone change\n */\nconst redoWrapper = async () => {\n  const state = {\n    brightness,\n    contrast,\n    saturation,\n    hue,\n    exposure,\n    vibrance,\n    sharpness,\n    highlights,\n    shadows,\n    temperature,\n    tint,\n    vignette,\n    blur,\n    grain,\n    rotation,\n    flipHorizontal,\n    flipVertical,\n    imageWidth,\n    imageHeight,\n  };\n  await redo(\n    history,\n    historyIndex,\n    state,\n    nextTick,\n    initializeCanvasWrapper,\n    currentImage\n  );\n};\n\n/**\n * Check if undo is available\n */\nconst canUndo = computed(() => historyIndex.value > 0);\n\n/**\n * Check if redo is available\n */\nconst canRedo = computed(() => historyIndex.value < history.value.length - 1);\n\n/**\n * Load image and initialize canvas\n */\nconst loadImageWrapper = async () => {\n  try {\n    const state = {\n      loading,\n      imageLoaded,\n      originalImage,\n      currentImage,\n      imageWidth,\n      imageHeight,\n      resizeWidth,\n      resizeHeight,\n      originalAspectRatio,\n    };\n    await loadImage(\n      props.src,\n      state,\n      nextTick,\n      initializeCanvasWrapper,\n      saveToHistoryWrapper\n    );\n  } catch (error) {\n    console.error('Failed to load image:', error);\n    loading.value = false;\n  }\n};\n\n/**\n * Initialize canvas with proper dimensions\n */\nconst initializeCanvasWrapper = () => {\n  const state = {\n    currentImage,\n    imageWidth,\n    imageHeight,\n    scale,\n  };\n  initializeCanvas(canvasRef.value, containerRef.value, state, drawImage);\n};\n\n/**\n * Draw image on canvas with all transformations and filters\n */\nconst drawImage = () => {\n  if (!canvasRef.value || !currentImage.value) return;\n\n  // If showing original, draw original image without filters\n  const imageToDraw = showOriginal.value\n    ? originalImage.value\n    : currentImage.value;\n\n  const canvas = canvasRef.value;\n  const ctx = canvas.getContext('2d');\n\n  // Clear canvas\n  ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n  // Save context\n  ctx.save();\n\n  // Center image\n  ctx.translate(canvas.width / 2, canvas.height / 2);\n\n  // Calculate image dimensions to fit canvas\n  const imgAspect = imageToDraw.width / imageToDraw.height;\n  const canvasAspect = canvas.width / canvas.height;\n\n  let drawWidth, drawHeight;\n\n  if (imgAspect > canvasAspect) {\n    drawWidth = canvas.width;\n    drawHeight = canvas.width / imgAspect;\n  } else {\n    drawHeight = canvas.height;\n    drawWidth = canvas.height * imgAspect;\n  }\n\n  // Apply transformations (only if not showing original)\n  if (!showOriginal.value) {\n    ctx.rotate((rotation.value * Math.PI) / 180);\n\n    // Apply flip\n    let scaleX = 1;\n    let scaleY = 1;\n    if (flipHorizontal.value) scaleX = -1;\n    if (flipVertical.value) scaleY = -1;\n    ctx.scale(scaleX, scaleY);\n  }\n\n  // Draw image\n  ctx.drawImage(\n    imageToDraw,\n    -drawWidth / 2,\n    -drawHeight / 2,\n    drawWidth,\n    drawHeight\n  );\n\n  ctx.restore();\n\n  // Apply filters for preview (but not during crop mode or when showing original)\n  if (!isCropping.value && !showOriginal.value) {\n    // Create a temporary canvas to apply filters to just the image area\n    const tempCanvas = document.createElement('canvas');\n    tempCanvas.width = canvas.width;\n    tempCanvas.height = canvas.height;\n    const tempCtx = tempCanvas.getContext('2d');\n\n    // Draw the current canvas content to temp canvas\n    tempCtx.drawImage(canvas, 0, 0);\n\n    // Apply filters to temp canvas\n    const filterValues = {\n      brightness: brightness.value,\n      contrast: contrast.value,\n      saturation: saturation.value,\n      hue: hue.value,\n      exposure: exposure.value,\n      vibrance: vibrance.value,\n      sharpness: sharpness.value,\n      highlights: highlights.value,\n      shadows: shadows.value,\n      temperature: temperature.value,\n      tint: tint.value,\n      vignette: vignette.value,\n      blur: blur.value,\n      grain: grain.value,\n    };\n    applyFiltersToCanvas(tempCanvas, filterValues);\n\n    // Clear main canvas and draw filtered result\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    ctx.drawImage(tempCanvas, 0, 0);\n  }\n\n  // Apply vignette overlay if needed\n  if (!showOriginal.value && vignette.value > 0) {\n    drawVignette(ctx, canvas, vignette.value);\n  }\n\n  // Show crop overlay if there's an active crop or a valid selection\n  if (isCropping.value && (cropActive.value || hasValidCropSelection.value)) {\n    drawCropOverlay(\n      ctx,\n      canvas,\n      cropStartX.value,\n      cropStartY.value,\n      cropEndX.value,\n      cropEndY.value\n    );\n    // Don't update button position here - wait for mouse up\n  } else {\n    buttonPosition.value = { centerX: 0, centerY: 0 };\n    showCropButtons.value = false;\n  }\n};\n\n/**\n * Apply filters for preview (using pixel manipulation for accurate preview)\n */\nconst applyCSSFilters = () => {\n  if (!canvasRef.value || !currentImage.value) return;\n\n  // Skip if all filters are at default\n  if (\n    brightness.value === 0 &&\n    contrast.value === 0 &&\n    saturation.value === 0 &&\n    hue.value === 0 &&\n    exposure.value === 0 &&\n    vibrance.value === 0 &&\n    sharpness.value === 0 &&\n    highlights.value === 0 &&\n    shadows.value === 0 &&\n    temperature.value === 0 &&\n    tint.value === 0 &&\n    blur.value === 0 &&\n    grain.value === 0\n  ) {\n    return;\n  }\n\n  const canvas = canvasRef.value;\n  const ctx = canvas.getContext('2d');\n\n  // Get current image data from canvas\n  let imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n\n  // Apply blur first if needed (before other filters)\n  if (blur.value > 0) {\n    imageData = applyBlur(imageData, blur.value / 10);\n    const tempCanvas = document.createElement('canvas');\n    tempCanvas.width = canvas.width;\n    tempCanvas.height = canvas.height;\n    const tempCtx = tempCanvas.getContext('2d');\n    tempCtx.putImageData(imageData, 0, 0);\n    imageData = tempCtx.getImageData(0, 0, canvas.width, canvas.height);\n  }\n\n  // Apply sharpness blur if needed (negative sharpness = blur)\n  if (sharpness.value < 0) {\n    imageData = applyBlur(imageData, Math.abs(sharpness.value) / 10);\n    const tempCanvas = document.createElement('canvas');\n    tempCanvas.width = canvas.width;\n    tempCanvas.height = canvas.height;\n    const tempCtx = tempCanvas.getContext('2d');\n    tempCtx.putImageData(imageData, 0, 0);\n    imageData = tempCtx.getImageData(0, 0, canvas.width, canvas.height);\n  }\n\n  const data = imageData.data;\n\n  const brightnessVal = brightness.value / 100;\n  const exposureVal = exposure.value / 100;\n  const contrastVal = contrast.value / 100;\n  const saturationVal = 1 + saturation.value / 100;\n  const vibranceVal = vibrance.value;\n  const hueVal = (hue.value * Math.PI) / 180;\n  const highlightsVal = highlights.value / 100;\n  const shadowsVal = shadows.value / 100;\n  const temperatureVal = temperature.value / 100;\n  const tintVal = tint.value / 100;\n\n  for (let i = 0; i < data.length; i += 4) {\n    let r = data[i];\n    let g = data[i + 1];\n    let b = data[i + 2];\n\n    // Calculate luminance for highlights/shadows\n    const luminance = 0.299 * r + 0.587 * g + 0.114 * b;\n\n    // Apply highlights (brighten bright areas)\n    if (highlightsVal !== 0 && luminance > 128) {\n      const highlightAmount = ((luminance - 128) / 127) * highlightsVal;\n      r += highlightAmount * 255;\n      g += highlightAmount * 255;\n      b += highlightAmount * 255;\n    }\n\n    // Apply shadows (darken dark areas)\n    if (shadowsVal !== 0 && luminance < 128) {\n      const shadowAmount = (1 - luminance / 127) * shadowsVal;\n      r -= shadowAmount * 255;\n      g -= shadowAmount * 255;\n      b -= shadowAmount * 255;\n    }\n\n    // Apply brightness and exposure (combined)\n    const totalBrightness = brightnessVal + exposureVal;\n    if (totalBrightness !== 0) {\n      r += totalBrightness * 255;\n      g += totalBrightness * 255;\n      b += totalBrightness * 255;\n    }\n\n    // Apply contrast (with exposure influence)\n    const totalContrast = contrastVal + exposureVal * 0.5;\n    if (totalContrast !== 0) {\n      const factor =\n        (259 * (totalContrast * 255 + 255)) /\n        (255 * (259 - totalContrast * 255));\n      r = factor * (r - 128) + 128;\n      g = factor * (g - 128) + 128;\n      b = factor * (b - 128) + 128;\n    }\n\n    // Apply temperature (cool/warm)\n    if (temperatureVal !== 0) {\n      if (temperatureVal > 0) {\n        // Warm (add red/yellow)\n        r += temperatureVal * 20;\n        g += temperatureVal * 10;\n      } else {\n        // Cool (add blue)\n        b += Math.abs(temperatureVal) * 20;\n        g += Math.abs(temperatureVal) * 5;\n      }\n    }\n\n    // Apply tint (green/magenta)\n    if (tintVal !== 0) {\n      if (tintVal > 0) {\n        // Magenta (add red and blue)\n        r += tintVal * 15;\n        b += tintVal * 15;\n      } else {\n        // Green (add green)\n        g += Math.abs(tintVal) * 20;\n      }\n    }\n\n    // Apply saturation (only if not 1, which means no change)\n    if (saturationVal !== 1) {\n      const gray = 0.299 * r + 0.587 * g + 0.114 * b;\n      r = gray + saturationVal * (r - gray);\n      g = gray + saturationVal * (g - gray);\n      b = gray + saturationVal * (b - gray);\n    }\n\n    // Apply vibrance (preserves skin tones)\n    if (vibranceVal !== 0) {\n      const vibranced = applyVibrance(r, g, b, vibranceVal);\n      r = vibranced.r;\n      g = vibranced.g;\n      b = vibranced.b;\n    }\n\n    // Apply hue rotation (only if non-zero)\n    if (hueVal !== 0) {\n      const cos = Math.cos(hueVal);\n      const sin = Math.sin(hueVal);\n      const newR =\n        r * (cos + (1 - cos) / 3) +\n        g * ((1 - cos) / 3 - (Math.sqrt(3) * sin) / 3) +\n        b * ((1 - cos) / 3 + (Math.sqrt(3) * sin) / 3);\n      const newG =\n        r * ((1 - cos) / 3 + (Math.sqrt(3) * sin) / 3) +\n        g * (cos + (1 - cos) / 3) +\n        b * ((1 - cos) / 3 - (Math.sqrt(3) * sin) / 3);\n      const newB =\n        r * ((1 - cos) / 3 - (Math.sqrt(3) * sin) / 3) +\n        g * ((1 - cos) / 3 + (Math.sqrt(3) * sin) / 3) +\n        b * (cos + (1 - cos) / 3);\n      r = newR;\n      g = newG;\n      b = newB;\n    }\n\n    data[i] = Math.max(0, Math.min(255, r));\n    data[i + 1] = Math.max(0, Math.min(255, g));\n    data[i + 2] = Math.max(0, Math.min(255, b));\n  }\n\n  ctx.putImageData(imageData, 0, 0);\n\n  // Apply sharpening last (after all other filters)\n  if (sharpness.value > 0) {\n    const sharpenedData = applySharpening(imageData, sharpness.value);\n    ctx.putImageData(sharpenedData, 0, 0);\n  }\n\n  // Apply grain last (after all other filters)\n  if (grain.value > 0) {\n    const grainedData = applyGrain(imageData, grain.value);\n    ctx.putImageData(grainedData, 0, 0);\n  }\n};\n\n/**\n * Handle mouse down for cropping\n */\nconst handleMouseDown = (event) => {\n  if (!canvasRef.value) return;\n\n  // Hide buttons immediately when starting a new interaction\n  showCropButtons.value = false;\n\n  const canvas = canvasRef.value;\n  const rect = canvas.getBoundingClientRect();\n  const x = event.clientX - rect.left;\n  const y = event.clientY - rect.top;\n\n  // Check if clicking inside existing crop area - if so, move it\n  if (hasValidCropSelection.value && isPointInCropArea(x, y)) {\n    isMovingCrop.value = true;\n    cropMoveStartX.value = x;\n    cropMoveStartY.value = y;\n\n    // Store the current crop bounds\n    const x1 = Math.min(cropStartX.value, cropEndX.value);\n    const y1 = Math.min(cropStartY.value, cropEndY.value);\n    const x2 = Math.max(cropStartX.value, cropEndX.value);\n    const y2 = Math.max(cropStartY.value, cropEndY.value);\n\n    cropOffsetX.value = x - (x1 + x2) / 2;\n    cropOffsetY.value = y - (y1 + y2) / 2;\n\n    canvas.addEventListener('mousemove', handleCropMove);\n    canvas.addEventListener('mouseup', handleCropMoveEnd);\n    canvas.addEventListener('mouseleave', handleCropMoveEnd);\n    return;\n  }\n\n  // Otherwise, start a new crop\n  cropStartX.value = x;\n  cropStartY.value = y;\n  cropEndX.value = x;\n  cropEndY.value = y;\n  cropActive.value = true;\n  isCropping.value = true;\n\n  drawImage();\n\n  canvas.addEventListener('mousemove', handleMouseMove);\n  canvas.addEventListener('mouseup', handleMouseUp);\n  canvas.addEventListener('mouseleave', handleMouseUp);\n};\n\n/**\n * Set crop aspect ratio preset\n */\nconst setCropAspectRatio = (ratio) => {\n  cropAspectRatio.value = ratio;\n\n  // If there's an existing crop, adjust it to the new aspect ratio\n  if (hasValidCropSelection.value) {\n    const x1 = Math.min(cropStartX.value, cropEndX.value);\n    const y1 = Math.min(cropStartY.value, cropEndY.value);\n    const x2 = Math.max(cropStartX.value, cropEndX.value);\n    const y2 = Math.max(cropStartY.value, cropEndY.value);\n\n    const width = x2 - x1;\n    const height = y2 - y1;\n\n    if (ratio !== null) {\n      const currentRatio = width / height;\n      if (currentRatio > ratio) {\n        // Too wide, adjust height\n        const newHeight = width / ratio;\n        cropEndY.value = y1 + newHeight;\n      } else {\n        // Too tall, adjust width\n        const newWidth = height * ratio;\n        cropEndX.value = x1 + newWidth;\n      }\n    }\n\n    drawImage();\n  }\n};\n\n/**\n * Handle mouse move for cropping\n */\nconst handleMouseMove = (event) => {\n  if (!cropActive.value || !canvasRef.value) return;\n\n  const canvas = canvasRef.value;\n  const rect = canvas.getBoundingClientRect();\n  let x = event.clientX - rect.left;\n  let y = event.clientY - rect.top;\n\n  // Apply aspect ratio constraint if set\n  if (cropAspectRatio.value !== null) {\n    const startX = cropStartX.value;\n    const startY = cropStartY.value;\n    const width = x - startX;\n    const height = y - startY;\n    const currentRatio = Math.abs(width / height);\n\n    if (currentRatio > cropAspectRatio.value) {\n      // Width is too large, adjust height\n      y =\n        startY +\n        (Math.abs(width) / cropAspectRatio.value) * (height < 0 ? -1 : 1);\n    } else {\n      // Height is too large, adjust width\n      x =\n        startX +\n        Math.abs(height) * cropAspectRatio.value * (width < 0 ? -1 : 1);\n    }\n  }\n\n  cropEndX.value = x;\n  cropEndY.value = y;\n\n  drawImage();\n};\n\n/**\n * Handle crop area movement\n */\nconst handleCropMove = (event) => {\n  if (!isMovingCrop.value || !canvasRef.value) return;\n\n  const canvas = canvasRef.value;\n  const rect = canvas.getBoundingClientRect();\n  const currentX = event.clientX - rect.left;\n  const currentY = event.clientY - rect.top;\n\n  // Calculate the movement delta\n  const deltaX = currentX - cropMoveStartX.value;\n  const deltaY = currentY - cropMoveStartY.value;\n\n  // Get current crop bounds\n  const x1 = Math.min(cropStartX.value, cropEndX.value);\n  const y1 = Math.min(cropStartY.value, cropEndY.value);\n  const x2 = Math.max(cropStartX.value, cropEndX.value);\n  const y2 = Math.max(cropStartY.value, cropEndY.value);\n\n  const width = x2 - x1;\n  const height = y2 - y1;\n\n  // Calculate new positions, keeping within canvas bounds\n  const newX1 = Math.max(0, Math.min(canvas.width - width, x1 + deltaX));\n  const newY1 = Math.max(0, Math.min(canvas.height - height, y1 + deltaY));\n  const newX2 = newX1 + width;\n  const newY2 = newY1 + height;\n\n  // Update crop coordinates\n  if (cropStartX.value < cropEndX.value) {\n    cropStartX.value = newX1;\n    cropEndX.value = newX2;\n  } else {\n    cropStartX.value = newX2;\n    cropEndX.value = newX1;\n  }\n\n  if (cropStartY.value < cropEndY.value) {\n    cropStartY.value = newY1;\n    cropEndY.value = newY2;\n  } else {\n    cropStartY.value = newY2;\n    cropEndY.value = newY1;\n  }\n\n  // Update move start position for next movement\n  cropMoveStartX.value = currentX;\n  cropMoveStartY.value = currentY;\n\n  drawImage();\n  // Update button position after moving crop\n  nextTick(() => {\n    updateButtonPosition();\n  });\n};\n\n/**\n * Handle crop move end\n */\nconst handleCropMoveEnd = () => {\n  isMovingCrop.value = false;\n\n  if (canvasRef.value) {\n    canvasRef.value.removeEventListener('mousemove', handleCropMove);\n    canvasRef.value.removeEventListener('mouseup', handleCropMoveEnd);\n    canvasRef.value.removeEventListener('mouseleave', handleCropMoveEnd);\n  }\n\n  drawImage();\n\n  // Show buttons immediately after moving crop\n  if (hasValidCropSelection.value) {\n    showCropButtons.value = true;\n    updateButtonPosition();\n  }\n};\n\n/**\n * Handle mouse up for cropping\n */\nconst handleMouseUp = () => {\n  // Remove event listeners\n  if (canvasRef.value) {\n    canvasRef.value.removeEventListener('mousemove', handleMouseMove);\n    canvasRef.value.removeEventListener('mouseup', handleMouseUp);\n    canvasRef.value.removeEventListener('mouseleave', handleMouseUp);\n  }\n\n  // Mark crop as no longer active (selection is complete)\n  cropActive.value = false;\n\n  // Redraw to show final crop selection (it will stay visible)\n  drawImage();\n\n  // Show buttons immediately after mouse up if there's a valid selection\n  if (hasValidCropSelection.value) {\n    showCropButtons.value = true;\n    updateButtonPosition();\n  }\n};\n\n/**\n * Start crop mode\n */\nconst startCrop = () => {\n  isCropping.value = true;\n  expandedSections.value.crop = true;\n  cropActive.value = false;\n  drawImage();\n};\n\n// Watch for crop section expansion - just expand the section, don't control crop mode\nwatch(\n  () => expandedSections.value.crop,\n  (isExpanded) => {\n    // Just ensure section is expanded, but don't control crop mode\n    // Crop mode is controlled by user interaction\n  }\n);\n\n/**\n * Apply crop\n */\nconst applyCrop = () => {\n  if (!canvasRef.value || !currentImage.value) return;\n\n  const canvas = canvasRef.value;\n  const x1 = Math.min(cropStartX.value, cropEndX.value);\n  const y1 = Math.min(cropStartY.value, cropEndY.value);\n  const x2 = Math.max(cropStartX.value, cropEndX.value);\n  const y2 = Math.max(cropStartY.value, cropEndY.value);\n\n  const width = x2 - x1;\n  const height = y2 - y1;\n\n  if (width <= 0 || height <= 0) {\n    cancelCrop();\n    return;\n  }\n\n  // Calculate the actual image coordinates from canvas coordinates\n  // Need to account for how the image is displayed on canvas\n  const imgAspect = currentImage.value.width / currentImage.value.height;\n  const canvasAspect = canvas.width / canvas.height;\n\n  let displayWidth, displayHeight, offsetX, offsetY;\n\n  if (imgAspect > canvasAspect) {\n    displayWidth = canvas.width;\n    displayHeight = canvas.width / imgAspect;\n    offsetX = 0;\n    offsetY = (canvas.height - displayHeight) / 2;\n  } else {\n    displayHeight = canvas.height;\n    displayWidth = canvas.height * imgAspect;\n    offsetX = (canvas.width - displayWidth) / 2;\n    offsetY = 0;\n  }\n\n  // Convert canvas crop coordinates to image coordinates\n  const scaleX = currentImage.value.width / displayWidth;\n  const scaleY = currentImage.value.height / displayHeight;\n\n  const imgX1 = Math.max(0, (x1 - offsetX) * scaleX);\n  const imgY1 = Math.max(0, (y1 - offsetY) * scaleY);\n  const imgX2 = Math.min(currentImage.value.width, (x2 - offsetX) * scaleX);\n  const imgY2 = Math.min(currentImage.value.height, (y2 - offsetY) * scaleY);\n\n  const cropWidth = imgX2 - imgX1;\n  const cropHeight = imgY2 - imgY1;\n\n  if (cropWidth <= 0 || cropHeight <= 0) {\n    cancelCrop();\n    return;\n  }\n\n  // Create new canvas for cropped image\n  const cropCanvas = document.createElement('canvas');\n  cropCanvas.width = cropWidth;\n  cropCanvas.height = cropHeight;\n  const cropCtx = cropCanvas.getContext('2d');\n\n  // Draw cropped portion from original image\n  cropCtx.drawImage(\n    currentImage.value,\n    imgX1,\n    imgY1,\n    cropWidth,\n    cropHeight,\n    0,\n    0,\n    cropWidth,\n    cropHeight\n  );\n\n  // Create new image from cropped canvas\n  const img = new Image();\n  img.onload = async () => {\n    currentImage.value = img;\n    imageWidth.value = img.width;\n    imageHeight.value = img.height;\n    resizeWidth.value = img.width;\n    resizeHeight.value = img.height;\n    originalAspectRatio.value = img.width / img.height;\n    isCropping.value = false;\n    cropActive.value = false;\n    rotation.value = 0;\n    flipHorizontal.value = false;\n    flipVertical.value = false;\n    await nextTick();\n    initializeCanvasWrapper();\n    saveToHistoryWrapper();\n  };\n  img.src = cropCanvas.toDataURL('image/png');\n};\n\n/**\n * Cancel crop\n */\nconst cancelCrop = () => {\n  isCropping.value = false;\n  cropActive.value = false;\n  cropStartX.value = 0;\n  cropStartY.value = 0;\n  cropEndX.value = 0;\n  cropEndY.value = 0;\n  showCropButtons.value = false;\n  drawImage();\n};\n\n/**\n * Rotate image wrapper\n */\nconst rotateImageWrapper = (degrees) => {\n  const state = { rotation };\n  rotateImage(state, degrees, drawImage);\n};\n\n/**\n * Flip image horizontally wrapper\n */\nconst flipImageHorizontalWrapper = () => {\n  const state = { flipHorizontal };\n  flipImageHorizontal(state, drawImage);\n};\n\n/**\n * Flip image vertically wrapper\n */\nconst flipImageVerticalWrapper = () => {\n  const state = { flipVertical };\n  flipImageVertical(state, drawImage);\n};\n\n/**\n * Reset all adjustments\n */\nconst resetAdjustments = () => {\n  brightness.value = 0;\n  contrast.value = 0;\n  saturation.value = 0;\n  hue.value = 0;\n  exposure.value = 0;\n  vibrance.value = 0;\n  sharpness.value = 0;\n  highlights.value = 0;\n  shadows.value = 0;\n  temperature.value = 0;\n  tint.value = 0;\n  vignette.value = 0;\n  blur.value = 0;\n  grain.value = 0;\n  drawImage();\n};\n\n/**\n * Reset all transformations wrapper\n */\nconst resetTransformationsWrapper = () => {\n  const state = { rotation, flipHorizontal, flipVertical };\n  resetTransformations(state, drawImage);\n  saveToHistoryWrapper();\n};\n\n/**\n * Reset everything\n */\nconst resetAll = async () => {\n  resetAdjustments();\n  resetTransformationsWrapper();\n  if (originalImage.value) {\n    currentImage.value = originalImage.value;\n    imageWidth.value = originalImage.value.width;\n    imageHeight.value = originalImage.value.height;\n    resizeWidth.value = originalImage.value.width;\n    resizeHeight.value = originalImage.value.height;\n    await nextTick();\n    initializeCanvasWrapper();\n  }\n};\n\n/**\n * Toggle section expansion\n */\nconst toggleSection = (section) => {\n  expandedSections.value[section] = !expandedSections.value[section];\n};\n\n/**\n * Handle resize width change\n */\nconst handleResizeWidthChangeWrapper = () => {\n  const state = {\n    resizeWidth,\n    resizeHeight,\n    lockAspectRatio,\n    originalAspectRatio,\n  };\n  handleResizeWidthChange(state);\n};\n\n/**\n * Handle resize height change\n */\nconst handleResizeHeightChangeWrapper = () => {\n  const state = {\n    resizeWidth,\n    resizeHeight,\n    lockAspectRatio,\n    originalAspectRatio,\n  };\n  handleResizeHeightChange(state);\n};\n\n/**\n * Apply resize\n */\nconst applyResizeWrapper = async () => {\n  const state = {\n    currentImage,\n    resizeWidth,\n    resizeHeight,\n    imageWidth,\n    imageHeight,\n    originalAspectRatio,\n  };\n  await applyResize(\n    state,\n    nextTick,\n    initializeCanvasWrapper,\n    saveToHistoryWrapper\n  );\n};\n\n/**\n * Export edited image\n */\nconst exportImageWrapper = () => {\n  const state = {\n    canvasRef: canvasRef.value,\n    currentImage,\n    resizeWidth,\n    resizeHeight,\n    imageWidth,\n    imageHeight,\n    rotation,\n    flipHorizontal,\n    flipVertical,\n    brightness,\n    contrast,\n    saturation,\n    hue,\n    exposure,\n    vibrance,\n    sharpness,\n    highlights,\n    shadows,\n    temperature,\n    tint,\n    vignette,\n    blur,\n    grain,\n  };\n  return exportImage(state, canvasRef.value);\n};\n\n/**\n * Handle save\n */\nconst handleSave = () => {\n  const dataUrl = exportImageWrapper();\n  if (dataUrl) {\n    emit('save', dataUrl);\n  }\n};\n\n/**\n * Handle cancel\n */\nconst handleCancel = () => {\n  emit('cancel');\n};\n\n// Watch for adjustments and redraw\nwatch(\n  [\n    brightness,\n    contrast,\n    saturation,\n    hue,\n    exposure,\n    vibrance,\n    sharpness,\n    highlights,\n    shadows,\n    temperature,\n    tint,\n    vignette,\n    blur,\n    grain,\n  ],\n  () => {\n    if (imageLoaded.value) {\n      drawImage();\n    }\n  }\n);\n\nwatch([rotation, flipHorizontal, flipVertical], () => {\n  if (imageLoaded.value) {\n    drawImage();\n  }\n});\n\nwatch(showOriginal, () => {\n  if (imageLoaded.value) {\n    drawImage();\n  }\n});\n\n// Debounced save to history for adjustments (save after user stops adjusting)\nlet historyTimeout = null;\nwatch(\n  [\n    brightness,\n    contrast,\n    saturation,\n    hue,\n    exposure,\n    vibrance,\n    sharpness,\n    highlights,\n    shadows,\n    temperature,\n    tint,\n    vignette,\n    blur,\n    grain,\n    rotation,\n    flipHorizontal,\n    flipVertical,\n  ],\n  () => {\n    if (imageLoaded.value && historyIndex.value >= 0) {\n      clearTimeout(historyTimeout);\n      historyTimeout = setTimeout(() => {\n        saveToHistoryWrapper();\n      }, 500); // Save 500ms after user stops adjusting\n    }\n  }\n);\n\n// Watch for crop changes to update button position\nwatch([cropStartX, cropStartY, cropEndX, cropEndY], () => {\n  if (hasValidCropSelection.value) {\n    updateButtonPosition();\n  }\n});\n\n// Watch for window resize\nconst handleResize = () => {\n  if (imageLoaded.value) {\n    initializeCanvasWrapper();\n  }\n};\n\n// Watch for scroll to update button position\nconst handleScroll = () => {\n  if (hasValidCropSelection.value) {\n    updateButtonPosition();\n  }\n};\n\nonMounted(async () => {\n  await loadImageWrapper();\n  window.addEventListener('resize', handleResize);\n  if (containerRef.value) {\n    containerRef.value.addEventListener('scroll', handleScroll);\n  }\n});\n\nonUnmounted(() => {\n  window.removeEventListener('resize', handleResize);\n  if (containerRef.value) {\n    containerRef.value.removeEventListener('scroll', handleScroll);\n  }\n});\n</script>\n\n<template>\n  <div class=\"flex-1 flex flex-col h-full bg-white dark:bg-zinc-950\">\n    <!-- Loading State -->\n    <div v-if=\"loading\" class=\"flex-1 flex items-center justify-center\">\n      <div class=\"text-center\">\n        <div\n          class=\"w-12 h-12 rounded-full bg-zinc-100 dark:bg-zinc-800 flex items-center justify-center mx-auto mb-3\"\n        >\n          <AppIcon\n            icon=\"image\"\n            class=\"text-xl text-zinc-400 dark:text-zinc-500 animate-pulse\"\n          />\n        </div>\n        <p class=\"text-sm text-zinc-500 dark:text-zinc-400\">\n          {{ __('Loading image...', 'uixpress') }}\n        </p>\n      </div>\n    </div>\n\n    <!-- Editor Interface -->\n    <div v-else class=\"flex-1 flex flex-col lg:flex-row h-full overflow-hidden\">\n      <!-- Canvas Area -->\n      <div\n        ref=\"containerRef\"\n        class=\"flex-1 flex items-center justify-center overflow-auto bg-white dark:bg-zinc-950 relative min-h-0\"\n      >\n        <canvas\n          ref=\"canvasRef\"\n          @mousedown=\"handleMouseDown\"\n          class=\"max-w-full max-h-full\"\n          :class=\"{\n            'cursor-crosshair': showCropCursor,\n            'cursor-move': isMovingCrop,\n          }\"\n        ></canvas>\n\n        <!-- Floating Crop Buttons -->\n        <div\n          v-if=\"hasValidCropSelection && showCropButtons\"\n          class=\"absolute flex items-center gap-2 z-10 pointer-events-auto\"\n          :style=\"{\n            left: `${buttonPosition.centerX}px`,\n            top: `${buttonPosition.centerY}px`,\n            transform: 'translate(-50%, -50%)',\n          }\"\n        >\n          <AppButton @click=\"applyCrop\" class=\"text-xs py-2 px-4 shadow-lg\">\n            {{ __('Apply', 'uixpress') }}\n          </AppButton>\n          <AppButton\n            @click=\"cancelCrop\"\n            type=\"transparent\"\n            class=\"text-xs py-2 px-4 shadow-lg bg-white/95 dark:bg-zinc-900/95 backdrop-blur-sm\"\n          >\n            {{ __('Cancel', 'uixpress') }}\n          </AppButton>\n        </div>\n      </div>\n\n      <!-- Controls Panel -->\n      <div\n        class=\"w-full lg:w-80 bg-white dark:bg-zinc-900 border-t lg:border-t-0 lg:border-l border-zinc-200 dark:border-zinc-800 flex flex-col min-h-0 lg:max-h-full overflow-hidden\"\n      >\n        <!-- Header -->\n        <div\n          class=\"px-4 py-3 border-b border-zinc-200 dark:border-zinc-800 flex items-center justify-between\"\n        >\n          <h2 class=\"text-sm font-semibold text-zinc-900 dark:text-zinc-200\">\n            {{ __('Image Editor', 'uixpress') }}\n          </h2>\n          <div class=\"flex items-center gap-2\">\n            <!-- Before/After Toggle -->\n            <AppButton\n              @click=\"showOriginal = !showOriginal\"\n              type=\"transparent\"\n              :class=\"[\n                'text-xs py-1.5 px-2',\n                showOriginal\n                  ? 'bg-indigo-500/20 text-indigo-400'\n                  : 'text-zinc-500 dark:text-zinc-400',\n              ]\"\n            >\n              <AppIcon icon=\"compare\" class=\"text-sm\" />\n            </AppButton>\n\n            <!-- Undo -->\n            <AppButton\n              @click=\"undoWrapper\"\n              type=\"transparent\"\n              class=\"text-xs py-1.5 px-2\"\n              :disabled=\"!canUndo\"\n            >\n              <AppIcon icon=\"undo\" class=\"text-sm\" />\n            </AppButton>\n\n            <!-- Redo -->\n            <AppButton\n              @click=\"redoWrapper\"\n              type=\"transparent\"\n              class=\"text-xs py-1.5 px-2\"\n              :disabled=\"!canRedo\"\n            >\n              <AppIcon icon=\"redo\" class=\"text-sm\" />\n            </AppButton>\n          </div>\n        </div>\n\n        <!-- Scrollable Content -->\n        <div class=\"flex-1 overflow-y-auto\">\n          <!-- Luminosity Section -->\n          <div class=\"border-b border-zinc-200 dark:border-zinc-800\">\n            <button\n              @click=\"toggleSection('luminosity')\"\n              class=\"w-full px-4 py-3 flex items-center justify-between hover:bg-zinc-100 dark:hover:bg-zinc-800/50 transition-colors\"\n            >\n              <span\n                class=\"text-sm font-medium text-zinc-900 dark:text-zinc-200\"\n                >{{ __('Luminosity', 'uixpress') }}</span\n              >\n              <AppIcon\n                :icon=\"\n                  expandedSections.luminosity ? 'expand_less' : 'expand_more'\n                \"\n                class=\"text-zinc-500 dark:text-zinc-400 text-base\"\n              />\n            </button>\n\n            <div v-if=\"expandedSections.luminosity\" class=\"px-4 pb-4 space-y-4\">\n              <!-- Brightness -->\n              <div>\n                <div class=\"flex items-center justify-between mb-1.5\">\n                  <label\n                    class=\"text-xs font-medium text-zinc-500 dark:text-zinc-400\"\n                  >\n                    {{ __('Brightness', 'uixpress') }}\n                  </label>\n                  <span class=\"text-xs text-zinc-500 font-mono\">{{\n                    brightness\n                  }}</span>\n                </div>\n                <input\n                  v-model.number=\"brightness\"\n                  type=\"range\"\n                  min=\"-100\"\n                  max=\"100\"\n                  step=\"1\"\n                  class=\"w-full h-1.5 bg-zinc-200 dark:bg-zinc-800 rounded-lg appearance-none cursor-pointer accent-indigo-500\"\n                />\n              </div>\n\n              <!-- Exposure -->\n              <div>\n                <div class=\"flex items-center justify-between mb-1.5\">\n                  <label\n                    class=\"text-xs font-medium text-zinc-500 dark:text-zinc-400\"\n                  >\n                    {{ __('Exposure', 'uixpress') }}\n                  </label>\n                  <span class=\"text-xs text-zinc-500 font-mono\">{{\n                    exposure\n                  }}</span>\n                </div>\n                <input\n                  v-model.number=\"exposure\"\n                  type=\"range\"\n                  min=\"-100\"\n                  max=\"100\"\n                  step=\"1\"\n                  class=\"w-full h-1.5 bg-zinc-200 dark:bg-zinc-800 rounded-lg appearance-none cursor-pointer accent-indigo-500\"\n                />\n              </div>\n\n              <!-- Highlights -->\n              <div>\n                <div class=\"flex items-center justify-between mb-1.5\">\n                  <label\n                    class=\"text-xs font-medium text-zinc-500 dark:text-zinc-400\"\n                  >\n                    {{ __('Highlights', 'uixpress') }}\n                  </label>\n                  <span class=\"text-xs text-zinc-500 font-mono\">{{\n                    highlights\n                  }}</span>\n                </div>\n                <input\n                  v-model.number=\"highlights\"\n                  type=\"range\"\n                  min=\"-100\"\n                  max=\"100\"\n                  step=\"1\"\n                  class=\"w-full h-1.5 bg-zinc-200 dark:bg-zinc-800 rounded-lg appearance-none cursor-pointer accent-indigo-500\"\n                />\n              </div>\n\n              <!-- Shadows -->\n              <div>\n                <div class=\"flex items-center justify-between mb-1.5\">\n                  <label\n                    class=\"text-xs font-medium text-zinc-500 dark:text-zinc-400\"\n                  >\n                    {{ __('Shadows', 'uixpress') }}\n                  </label>\n                  <span class=\"text-xs text-zinc-500 font-mono\">{{\n                    shadows\n                  }}</span>\n                </div>\n                <input\n                  v-model.number=\"shadows\"\n                  type=\"range\"\n                  min=\"-100\"\n                  max=\"100\"\n                  step=\"1\"\n                  class=\"w-full h-1.5 bg-zinc-200 dark:bg-zinc-800 rounded-lg appearance-none cursor-pointer accent-indigo-500\"\n                />\n              </div>\n\n              <!-- Contrast -->\n              <div>\n                <div class=\"flex items-center justify-between mb-1.5\">\n                  <label\n                    class=\"text-xs font-medium text-zinc-500 dark:text-zinc-400\"\n                  >\n                    {{ __('Contrast', 'uixpress') }}\n                  </label>\n                  <span class=\"text-xs text-zinc-500 font-mono\">{{\n                    contrast\n                  }}</span>\n                </div>\n                <input\n                  v-model.number=\"contrast\"\n                  type=\"range\"\n                  min=\"-100\"\n                  max=\"100\"\n                  step=\"1\"\n                  class=\"w-full h-1.5 bg-zinc-200 dark:bg-zinc-800 rounded-lg appearance-none cursor-pointer accent-indigo-500\"\n                />\n              </div>\n            </div>\n          </div>\n\n          <!-- Color Section -->\n          <div class=\"border-b border-zinc-200 dark:border-zinc-800\">\n            <button\n              @click=\"toggleSection('color')\"\n              class=\"w-full px-4 py-3 flex items-center justify-between hover:bg-zinc-100 dark:hover:bg-zinc-800/50 transition-colors\"\n            >\n              <span\n                class=\"text-sm font-medium text-zinc-900 dark:text-zinc-200\"\n                >{{ __('Color', 'uixpress') }}</span\n              >\n              <AppIcon\n                :icon=\"expandedSections.color ? 'expand_less' : 'expand_more'\"\n                class=\"text-zinc-500 dark:text-zinc-400 text-base\"\n              />\n            </button>\n\n            <div v-if=\"expandedSections.color\" class=\"px-4 pb-4 space-y-4\">\n              <!-- Saturation -->\n              <div>\n                <div class=\"flex items-center justify-between mb-1.5\">\n                  <label\n                    class=\"text-xs font-medium text-zinc-500 dark:text-zinc-400\"\n                  >\n                    {{ __('Saturation', 'uixpress') }}\n                  </label>\n                  <span class=\"text-xs text-zinc-500 font-mono\">{{\n                    saturation\n                  }}</span>\n                </div>\n                <input\n                  v-model.number=\"saturation\"\n                  type=\"range\"\n                  min=\"-100\"\n                  max=\"100\"\n                  step=\"1\"\n                  class=\"w-full h-1.5 bg-zinc-200 dark:bg-zinc-800 rounded-lg appearance-none cursor-pointer accent-indigo-500\"\n                />\n              </div>\n\n              <!-- Vibrance -->\n              <div>\n                <div class=\"flex items-center justify-between mb-1.5\">\n                  <label\n                    class=\"text-xs font-medium text-zinc-500 dark:text-zinc-400\"\n                  >\n                    {{ __('Vibrance', 'uixpress') }}\n                  </label>\n                  <span class=\"text-xs text-zinc-500 font-mono\">{{\n                    vibrance\n                  }}</span>\n                </div>\n                <input\n                  v-model.number=\"vibrance\"\n                  type=\"range\"\n                  min=\"-100\"\n                  max=\"100\"\n                  step=\"1\"\n                  class=\"w-full h-1.5 bg-zinc-200 dark:bg-zinc-800 rounded-lg appearance-none cursor-pointer accent-indigo-500\"\n                />\n              </div>\n\n              <!-- Hue -->\n              <div>\n                <div class=\"flex items-center justify-between mb-1.5\">\n                  <label\n                    class=\"text-xs font-medium text-zinc-500 dark:text-zinc-400\"\n                  >\n                    {{ __('Hue', 'uixpress') }}\n                  </label>\n                  <span class=\"text-xs text-zinc-500 font-mono\"\n                    >{{ hue }}</span\n                  >\n                </div>\n                <input\n                  v-model.number=\"hue\"\n                  type=\"range\"\n                  min=\"-180\"\n                  max=\"180\"\n                  step=\"1\"\n                  class=\"w-full h-1.5 bg-zinc-200 dark:bg-zinc-800 rounded-lg appearance-none cursor-pointer accent-indigo-500\"\n                />\n              </div>\n\n              <!-- Temperature -->\n              <div>\n                <div class=\"flex items-center justify-between mb-1.5\">\n                  <label\n                    class=\"text-xs font-medium text-zinc-500 dark:text-zinc-400\"\n                  >\n                    {{ __('Temperature', 'uixpress') }}\n                  </label>\n                  <span class=\"text-xs text-zinc-500 font-mono\">{{\n                    temperature\n                  }}</span>\n                </div>\n                <input\n                  v-model.number=\"temperature\"\n                  type=\"range\"\n                  min=\"-100\"\n                  max=\"100\"\n                  step=\"1\"\n                  class=\"w-full h-1.5 bg-zinc-200 dark:bg-zinc-800 rounded-lg appearance-none cursor-pointer accent-indigo-500\"\n                />\n                <p class=\"text-[10px] text-zinc-500 dark:text-zinc-400 mt-0.5\">\n                  {{ __('Cool   Warm', 'uixpress') }}\n                </p>\n              </div>\n\n              <!-- Tint -->\n              <div>\n                <div class=\"flex items-center justify-between mb-1.5\">\n                  <label\n                    class=\"text-xs font-medium text-zinc-500 dark:text-zinc-400\"\n                  >\n                    {{ __('Tint', 'uixpress') }}\n                  </label>\n                  <span class=\"text-xs text-zinc-500 font-mono\">{{\n                    tint\n                  }}</span>\n                </div>\n                <input\n                  v-model.number=\"tint\"\n                  type=\"range\"\n                  min=\"-100\"\n                  max=\"100\"\n                  step=\"1\"\n                  class=\"w-full h-1.5 bg-zinc-200 dark:bg-zinc-800 rounded-lg appearance-none cursor-pointer accent-indigo-500\"\n                />\n                <p class=\"text-[10px] text-zinc-500 dark:text-zinc-400 mt-0.5\">\n                  {{ __('Green   Magenta', 'uixpress') }}\n                </p>\n              </div>\n            </div>\n          </div>\n\n          <!-- Effects Section -->\n          <div class=\"border-b border-zinc-200 dark:border-zinc-800\">\n            <button\n              @click=\"toggleSection('effects')\"\n              class=\"w-full px-4 py-3 flex items-center justify-between hover:bg-zinc-100 dark:hover:bg-zinc-800/50 transition-colors\"\n            >\n              <span\n                class=\"text-sm font-medium text-zinc-900 dark:text-zinc-200\"\n                >{{ __('Effects', 'uixpress') }}</span\n              >\n              <AppIcon\n                :icon=\"expandedSections.effects ? 'expand_less' : 'expand_more'\"\n                class=\"text-zinc-500 dark:text-zinc-400 text-base\"\n              />\n            </button>\n\n            <div v-if=\"expandedSections.effects\" class=\"px-4 pb-4 space-y-4\">\n              <!-- Sharpness -->\n              <div>\n                <div class=\"flex items-center justify-between mb-1.5\">\n                  <label\n                    class=\"text-xs font-medium text-zinc-500 dark:text-zinc-400\"\n                  >\n                    {{ __('Sharpness', 'uixpress') }}\n                  </label>\n                  <span class=\"text-xs text-zinc-500 font-mono\">{{\n                    sharpness\n                  }}</span>\n                </div>\n                <input\n                  v-model.number=\"sharpness\"\n                  type=\"range\"\n                  min=\"-100\"\n                  max=\"100\"\n                  step=\"1\"\n                  class=\"w-full h-1.5 bg-zinc-200 dark:bg-zinc-800 rounded-lg appearance-none cursor-pointer accent-indigo-500\"\n                />\n                <p class=\"text-[10px] text-zinc-500 dark:text-zinc-400 mt-0.5\">\n                  {{ __('Negative = blur, positive = sharpen', 'uixpress') }}\n                </p>\n              </div>\n\n              <!-- Blur -->\n              <div>\n                <div class=\"flex items-center justify-between mb-1.5\">\n                  <label\n                    class=\"text-xs font-medium text-zinc-500 dark:text-zinc-400\"\n                  >\n                    {{ __('Blur', 'uixpress') }}\n                  </label>\n                  <span class=\"text-xs text-zinc-500 font-mono\">{{\n                    blur\n                  }}</span>\n                </div>\n                <input\n                  v-model.number=\"blur\"\n                  type=\"range\"\n                  min=\"0\"\n                  max=\"100\"\n                  step=\"1\"\n                  class=\"w-full h-1.5 bg-zinc-200 dark:bg-zinc-800 rounded-lg appearance-none cursor-pointer accent-indigo-500\"\n                />\n              </div>\n\n              <!-- Grain -->\n              <div>\n                <div class=\"flex items-center justify-between mb-1.5\">\n                  <label\n                    class=\"text-xs font-medium text-zinc-500 dark:text-zinc-400\"\n                  >\n                    {{ __('Grain', 'uixpress') }}\n                  </label>\n                  <span class=\"text-xs text-zinc-500 font-mono\">{{\n                    grain\n                  }}</span>\n                </div>\n                <input\n                  v-model.number=\"grain\"\n                  type=\"range\"\n                  min=\"0\"\n                  max=\"100\"\n                  step=\"1\"\n                  class=\"w-full h-1.5 bg-zinc-200 dark:bg-zinc-800 rounded-lg appearance-none cursor-pointer accent-indigo-500\"\n                />\n              </div>\n\n              <!-- Vignette -->\n              <div>\n                <div class=\"flex items-center justify-between mb-1.5\">\n                  <label\n                    class=\"text-xs font-medium text-zinc-500 dark:text-zinc-400\"\n                  >\n                    {{ __('Vignette', 'uixpress') }}\n                  </label>\n                  <span class=\"text-xs text-zinc-500 font-mono\">{{\n                    vignette\n                  }}</span>\n                </div>\n                <input\n                  v-model.number=\"vignette\"\n                  type=\"range\"\n                  min=\"0\"\n                  max=\"100\"\n                  step=\"1\"\n                  class=\"w-full h-1.5 bg-zinc-200 dark:bg-zinc-800 rounded-lg appearance-none cursor-pointer accent-indigo-500\"\n                />\n              </div>\n            </div>\n          </div>\n\n          <!-- Crop Section -->\n          <div class=\"border-b border-zinc-200 dark:border-zinc-800\">\n            <button\n              @click=\"toggleSection('crop')\"\n              class=\"w-full px-4 py-3 flex items-center justify-between hover:bg-zinc-100 dark:hover:bg-zinc-800/50 transition-colors\"\n            >\n              <span\n                class=\"text-sm font-medium text-zinc-900 dark:text-zinc-200\"\n                >{{ __('Crop', 'uixpress') }}</span\n              >\n              <AppIcon\n                :icon=\"expandedSections.crop ? 'expand_less' : 'expand_more'\"\n                class=\"text-zinc-500 dark:text-zinc-400 text-base\"\n              />\n            </button>\n\n            <div v-if=\"expandedSections.crop\" class=\"px-4 pb-4 space-y-3\">\n              <p class=\"text-xs text-zinc-500 dark:text-zinc-400 mb-2\">\n                {{\n                  __(\n                    'Click and drag on the image to select crop area',\n                    'uixpress'\n                  )\n                }}\n              </p>\n\n              <!-- Aspect Ratio Presets -->\n              <div>\n                <label\n                  class=\"text-xs font-medium text-zinc-500 dark:text-zinc-400 mb-2 block\"\n                >\n                  {{ __('Aspect Ratio', 'uixpress') }}\n                </label>\n                <div class=\"grid grid-cols-3 gap-1.5\">\n                  <button\n                    v-for=\"preset in cropAspectRatioPresets\"\n                    :key=\"preset.value\"\n                    @click=\"setCropAspectRatio(preset.value)\"\n                    :class=\"[\n                      'px-2 py-1.5 text-xs rounded-md transition-colors',\n                      cropAspectRatio === preset.value\n                        ? 'bg-indigo-500 text-white'\n                        : 'bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-300 hover:bg-zinc-200 dark:hover:bg-zinc-700',\n                    ]\"\n                  >\n                    {{ preset.label }}\n                  </button>\n                </div>\n              </div>\n\n              <AppButton\n                @click=\"\n                  isCropping = true;\n                  expandedSections.crop = true;\n                \"\n                type=\"transparent\"\n                class=\"w-full text-xs py-1.5\"\n              >\n                {{ __('Start Crop', 'uixpress') }}\n              </AppButton>\n            </div>\n          </div>\n\n          <!-- Resize Section -->\n          <div class=\"border-b border-zinc-200 dark:border-zinc-800\">\n            <button\n              @click=\"toggleSection('resize')\"\n              class=\"w-full px-4 py-3 flex items-center justify-between hover:bg-zinc-100 dark:hover:bg-zinc-800/50 transition-colors\"\n            >\n              <span\n                class=\"text-sm font-medium text-zinc-900 dark:text-zinc-200\"\n                >{{ __('Resize', 'uixpress') }}</span\n              >\n              <AppIcon\n                :icon=\"expandedSections.resize ? 'expand_less' : 'expand_more'\"\n                class=\"text-zinc-500 dark:text-zinc-400 text-base\"\n              />\n            </button>\n\n            <div v-if=\"expandedSections.resize\" class=\"px-4 pb-4 space-y-3\">\n              <!-- Aspect Ratio Lock -->\n              <div class=\"flex items-center gap-2\">\n                <input\n                  v-model=\"lockAspectRatio\"\n                  type=\"checkbox\"\n                  id=\"lockAspectRatio\"\n                  class=\"w-4 h-4 rounded border-zinc-300 dark:border-zinc-700 bg-zinc-100 dark:bg-zinc-800 text-indigo-500 focus:ring-indigo-500\"\n                />\n                <label\n                  for=\"lockAspectRatio\"\n                  class=\"text-xs text-zinc-500 dark:text-zinc-400\"\n                >\n                  {{ __('Lock aspect ratio', 'uixpress') }}\n                </label>\n              </div>\n\n              <!-- Width -->\n              <div>\n                <div class=\"flex items-center justify-between mb-1.5\">\n                  <label\n                    class=\"text-xs font-medium text-zinc-500 dark:text-zinc-400\"\n                  >\n                    {{ __('Width', 'uixpress') }}\n                  </label>\n                  <span class=\"text-xs text-zinc-500 font-mono\"\n                    >{{ resizeWidth }}px</span\n                  >\n                </div>\n                <input\n                  v-model.number=\"resizeWidth\"\n                  @input=\"handleResizeWidthChangeWrapper\"\n                  type=\"number\"\n                  min=\"1\"\n                  class=\"w-full px-2 py-1.5 text-xs bg-zinc-100 dark:bg-zinc-800 border border-zinc-300 dark:border-zinc-700 rounded text-zinc-900 dark:text-zinc-200 focus:outline-none focus:ring-1 focus:ring-indigo-500\"\n                />\n              </div>\n\n              <!-- Height -->\n              <div>\n                <div class=\"flex items-center justify-between mb-1.5\">\n                  <label\n                    class=\"text-xs font-medium text-zinc-500 dark:text-zinc-400\"\n                  >\n                    {{ __('Height', 'uixpress') }}\n                  </label>\n                  <span class=\"text-xs text-zinc-500 font-mono\"\n                    >{{ resizeHeight }}px</span\n                  >\n                </div>\n                <input\n                  v-model.number=\"resizeHeight\"\n                  @input=\"handleResizeHeightChangeWrapper\"\n                  type=\"number\"\n                  min=\"1\"\n                  class=\"w-full px-2 py-1.5 text-xs bg-zinc-100 dark:bg-zinc-800 border border-zinc-300 dark:border-zinc-700 rounded text-zinc-900 dark:text-zinc-200 focus:outline-none focus:ring-1 focus:ring-indigo-500\"\n                />\n              </div>\n\n              <!-- Apply Resize Button -->\n              <AppButton\n                @click=\"applyResizeWrapper\"\n                class=\"w-full text-xs py-1.5\"\n                :disabled=\"resizeWidth <= 0 || resizeHeight <= 0\"\n              >\n                {{ __('Apply Resize', 'uixpress') }}\n              </AppButton>\n            </div>\n          </div>\n\n          <!-- Transform Section -->\n          <div class=\"border-b border-zinc-200 dark:border-zinc-800\">\n            <button\n              @click=\"toggleSection('transform')\"\n              class=\"w-full px-4 py-3 flex items-center justify-between hover:bg-zinc-100 dark:hover:bg-zinc-800/50 transition-colors\"\n            >\n              <span\n                class=\"text-sm font-medium text-zinc-900 dark:text-zinc-200\"\n                >{{ __('Transform', 'uixpress') }}</span\n              >\n              <AppIcon\n                :icon=\"\n                  expandedSections.transform ? 'expand_less' : 'expand_more'\n                \"\n                class=\"text-zinc-500 dark:text-zinc-400 text-base\"\n              />\n            </button>\n\n            <div v-if=\"expandedSections.transform\" class=\"px-4 pb-4 space-y-3\">\n              <div class=\"grid grid-cols-2 gap-2\">\n                <!-- Rotate Left -->\n                <AppButton\n                  @click=\"rotateImageWrapper(-90)\"\n                  type=\"transparent\"\n                  class=\"flex items-center justify-center gap-1.5 text-xs py-2\"\n                >\n                  <AppIcon icon=\"rotate_left\" class=\"text-sm\" />\n                  {{ __('Left', 'uixpress') }}\n                </AppButton>\n\n                <!-- Rotate Right -->\n                <AppButton\n                  @click=\"rotateImageWrapper(90)\"\n                  type=\"transparent\"\n                  class=\"flex items-center justify-center gap-1.5 text-xs py-2\"\n                >\n                  <AppIcon icon=\"rotate_right\" class=\"text-sm\" />\n                  {{ __('Right', 'uixpress') }}\n                </AppButton>\n\n                <!-- Flip Horizontal -->\n                <AppButton\n                  @click=\"flipImageHorizontalWrapper\"\n                  type=\"transparent\"\n                  :class=\"[\n                    'flex items-center justify-center gap-1.5 text-xs py-2',\n                    flipHorizontal ? 'bg-indigo-500/20 text-indigo-400' : '',\n                  ]\"\n                >\n                  <AppIcon icon=\"flip\" class=\"text-sm\" />\n                  {{ __('Flip H', 'uixpress') }}\n                </AppButton>\n\n                <!-- Flip Vertical -->\n                <AppButton\n                  @click=\"flipImageVerticalWrapper\"\n                  type=\"transparent\"\n                  :class=\"[\n                    'flex items-center justify-center gap-1.5 text-xs py-2',\n                    flipVertical ? 'bg-indigo-500/20 text-indigo-400' : '',\n                  ]\"\n                >\n                  <AppIcon icon=\"flip_camera_android\" class=\"text-sm\" />\n                  {{ __('Flip V', 'uixpress') }}\n                </AppButton>\n              </div>\n\n              <!-- Reset Button -->\n              <AppButton\n                @click=\"resetTransformationsWrapper\"\n                type=\"transparent\"\n                class=\"w-full text-xs py-1.5\"\n              >\n                {{ __('Reset', 'uixpress') }}\n              </AppButton>\n            </div>\n          </div>\n        </div>\n\n        <!-- Panel Footer -->\n        <div\n          class=\"px-4 py-3 border-t border-zinc-200 dark:border-zinc-800 flex items-center justify-end gap-2 bg-white dark:bg-zinc-900\"\n        >\n          <!-- Reset Button -->\n          <AppButton\n            @click=\"resetAdjustments\"\n            type=\"transparent\"\n            class=\"text-xs py-1.5 mr-auto\"\n          >\n            {{ __('Reset changes', 'uixpress') }}\n          </AppButton>\n\n          <AppButton\n            @click=\"handleCancel\"\n            type=\"transparent\"\n            class=\"text-xs py-2 px-3\"\n          >\n            {{ __('Cancel', 'uixpress') }}\n          </AppButton>\n          <AppButton @click=\"handleSave\" class=\"text-xs py-2 px-3\">\n            {{ __('Save', 'uixpress') }}\n          </AppButton>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<style scoped>\ninput[type='range'] {\n  -webkit-appearance: none;\n  appearance: none;\n}\n\ninput[type='range']::-webkit-slider-thumb {\n  -webkit-appearance: none;\n  appearance: none;\n  width: 16px;\n  height: 16px;\n  background: #3b82f6;\n  border-radius: 50%;\n  cursor: pointer;\n}\n\ninput[type='range']::-moz-range-thumb {\n  width: 16px;\n  height: 16px;\n  background: #3b82f6;\n  border-radius: 50%;\n  cursor: pointer;\n  border: none;\n}\n</style>\n","<script setup>\nimport { ref, onMounted } from 'vue';\nimport { useRoute, useRouter } from 'vue-router';\n\n// Store\nimport { useAppStore } from '@/store/app/app.js';\nconst appStore = useAppStore();\n\n// Funcs\nimport { lmnFetch } from '@/assets/js/functions/lmnFetch.js';\nimport { notify } from '@/assets/js/functions/notify.js';\n\n// Comps\nimport AppIcon from '@/components/utility/icons/index.vue';\nimport AppButton from '@/components/utility/app-button/index.vue';\nimport ImageEditor from '@/components/utility/image-editor/index.vue';\n\nconst route = useRoute();\nconst router = useRouter();\n\nconst loading = ref(false);\nconst mediaItem = ref(null);\nconst isSaving = ref(false);\n\n/**\n * Fetches media item data by ID from WordPress REST API\n */\nconst getMediaItem = async () => {\n  if (!route.params.mediaId) return;\n\n  loading.value = true;\n  appStore.updateState('loading', true);\n\n  const args = {\n    endpoint: `wp/v2/media/${route.params.mediaId}`,\n    params: {\n      context: 'edit',\n    },\n  };\n\n  const data = await lmnFetch(args);\n\n  loading.value = false;\n  appStore.updateState('loading', false);\n\n  if (!data?.data) {\n    notify({\n      title: __('Media item not found', 'uixpress'),\n      type: 'error',\n    });\n    router.push({ name: 'media-library' });\n    return;\n  }\n\n  mediaItem.value = data.data;\n\n  // Only allow editing for images\n  if (!mediaItem.value.mime_type.startsWith('image/')) {\n    notify({\n      title: __('Only images can be edited', 'uixpress'),\n      type: 'error',\n    });\n    router.push({\n      name: 'media-details',\n      params: { mediaId: route.params.mediaId },\n    });\n    return;\n  }\n};\n\n/**\n * Handle save from image editor\n */\nconst handleSave = async (dataUrl) => {\n  if (!dataUrl) return;\n\n  isSaving.value = true;\n\n  try {\n    // Convert data URL to blob\n    const response = await fetch(dataUrl);\n    const blob = await response.blob();\n\n    // Create a file from the blob\n    const editedFile = new File(\n      [blob],\n      mediaItem.value.media_details?.file || 'edited-image.jpg',\n      {\n        type: 'image/jpeg',\n      }\n    );\n\n    // Create FormData for file upload\n    const formData = new FormData();\n    formData.append('file', editedFile);\n    formData.append('action', 'replace_media_file');\n    formData.append('media_id', mediaItem.value.id);\n\n    const args = {\n      endpoint: 'uixpress/v1/media/replace',\n      type: 'POST',\n      data: formData,\n      isFormData: true,\n    };\n\n    const data = await lmnFetch(args);\n\n    if (data?.data) {\n      notify({\n        title: __('Image saved successfully', 'uixpress'),\n        type: 'success',\n      });\n\n      // Navigate back to details view\n      router.push({\n        name: 'media-details',\n        params: { mediaId: route.params.mediaId },\n      });\n    }\n  } catch (error) {\n    console.error('Save error:', error);\n    notify({\n      title: __('Failed to save image', 'uixpress'),\n      type: 'error',\n    });\n  } finally {\n    isSaving.value = false;\n  }\n};\n\n/**\n * Handle cancel from image editor\n */\nconst handleCancel = () => {\n  router.push({\n    name: 'media-details',\n    params: { mediaId: route.params.mediaId },\n  });\n};\n\n/**\n * Format file size\n */\nconst formatFileSize = (bytes) => {\n  if (!bytes) return '';\n  const sizes = ['B', 'KB', 'MB', 'GB'];\n  const i = Math.floor(Math.log(bytes) / Math.log(1024));\n  return Math.round((bytes / Math.pow(1024, i)) * 10) / 10 + ' ' + sizes[i];\n};\n\n/**\n * Format date\n */\nconst formatDate = (dateString) => {\n  return new Date(dateString).toLocaleDateString(undefined, {\n    month: 'short',\n    day: 'numeric',\n    year: 'numeric',\n  });\n};\n\n// Lifecycle\nonMounted(async () => {\n  await getMediaItem();\n});\n</script>\n\n<template>\n  <div class=\"flex-1 flex h-full max-h-full overflow-hidden bg-white dark:bg-zinc-950\">\n    <!-- Loading State -->\n    <div v-if=\"loading\" class=\"flex-1 flex items-center justify-center\">\n      <div class=\"text-center\">\n        <div\n          class=\"w-12 h-12 rounded-full bg-zinc-100 dark:bg-zinc-900 flex items-center justify-center mx-auto mb-3\"\n        >\n          <AppIcon icon=\"image\" class=\"text-xl text-zinc-400 animate-pulse\" />\n        </div>\n        <p class=\"text-sm text-zinc-500 dark:text-zinc-400\">{{ __('Loading...', 'uixpress') }}</p>\n      </div>\n    </div>\n\n    <!-- Editor Interface -->\n    <div v-else-if=\"mediaItem\" class=\"flex-1 flex flex-col h-full\">\n      <!-- Header -->\n      <div\n        class=\"flex items-center justify-between px-6 py-2 border-b border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-900\"\n      >\n        <div class=\"flex items-center gap-4\">\n          <button\n            @click=\"handleCancel\"\n            class=\"flex items-center gap-2 px-3 py-2 rounded-lg text-zinc-500 dark:text-zinc-400 hover:text-zinc-900 dark:hover:text-white hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors\"\n          >\n            <AppIcon icon=\"arrow_back\" class=\"text-base\" />\n            <span class=\"text-sm\">{{ __('Back', 'uixpress') }}</span>\n          </button>\n\n          <div class=\"flex items-center gap-3\">\n            <div>\n              <p class=\"text-sm text-zinc-500 dark:text-zinc-400\">\n                {{ mediaItem.media_details?.file || 'image.jpg' }}\n              </p>\n            </div>\n          </div>\n        </div>\n\n        <div class=\"flex items-center gap-3\">\n          <!-- Image Info -->\n          <div class=\"text-sm text-zinc-500 dark:text-zinc-400\">\n            <span\n              v-if=\"\n                mediaItem.media_details?.width &&\n                mediaItem.media_details?.height\n              \"\n            >\n              {{ mediaItem.media_details.width }} \n              {{ mediaItem.media_details.height }}\n            </span>\n            <span class=\"mx-2\"></span>\n            <span>{{ formatFileSize(mediaItem.media_details?.filesize) }}</span>\n          </div>\n        </div>\n      </div>\n\n      <!-- Editor Container -->\n      <div class=\"flex-1 overflow-hidden\">\n        <ImageEditor\n          v-if=\"mediaItem.source_url\"\n          :src=\"mediaItem.source_url\"\n          @save=\"handleSave\"\n          @cancel=\"handleCancel\"\n        />\n      </div>\n    </div>\n  </div>\n</template>\n"],"names":["applySharpening","imageData","amount","data","width","height","output","outputData","kernel","strength","y","x","r","g","b","ky","kx","idx","applyGrain","grainAmount","i","grain","applyBlur","radius","rSum","gSum","bSum","count","dx","px","tempData","dy","applyVibrance","vibranceVal","max","min","saturation","adjustment","gray","vibranceFactor","applyFiltersToCanvas","canvas","filterValues","brightness","contrast","hue","exposure","vibrance","sharpness","highlights","shadows","temperature","tint","blur","vignette","ctx","tempCanvas","tempCtx","brightnessVal","exposureVal","contrastVal","saturationVal","hueVal","highlightsVal","shadowsVal","temperatureVal","tintVal","luminance","highlightAmount","shadowAmount","totalBrightness","totalContrast","factor","vibranced","cos","sin","newR","newG","newB","sharpenedData","grainedData","centerX","centerY","maxRadius","intensity","gradient","rotateImage","state","degrees","drawImage","flipImageHorizontal","flipImageVertical","resetTransformations","saveToHistory","history","historyIndex","maxHistorySize","currentImage","historyState","restoreState","nextTick","initializeCanvas","_a","img","resolve","reject","undo","previousState","redo","nextState","handleResizeWidthChange","handleResizeHeightChange","applyResize","loadImage","src","canvasRef","containerRef","container","containerWidth","containerHeight","imageAspect","containerAspect","displayWidth","displayHeight","exportImage","exportWidth","exportHeight","exportCanvas","exportCtx","drawVignette","vignetteValue","drawCropOverlay","cropStartX","cropStartY","cropEndX","cropEndY","x1","y1","x2","y2","handleSize","props","__props","emit","__emit","ref","imageLoaded","loading","originalImage","imageWidth","imageHeight","scale","rotation","flipHorizontal","flipVertical","resizeWidth","resizeHeight","lockAspectRatio","originalAspectRatio","showOriginal","isCropping","cropActive","isMovingCrop","cropMoveStartX","cropMoveStartY","cropOffsetX","cropOffsetY","buttonPosition","showCropButtons","cropAspectRatio","cropAspectRatioPresets","expandedSections","hasValidCropSelection","computed","updateButtonPosition","canvasRect","containerRect","canvasOffsetX","canvasOffsetY","isPointInCropArea","showCropCursor","saveToHistoryWrapper","undoWrapper","initializeCanvasWrapper","redoWrapper","canUndo","canRedo","loadImageWrapper","error","imageToDraw","imgAspect","canvasAspect","drawWidth","drawHeight","scaleX","scaleY","handleMouseDown","event","rect","handleCropMove","handleCropMoveEnd","handleMouseMove","handleMouseUp","setCropAspectRatio","ratio","newHeight","newWidth","startX","startY","currentX","currentY","deltaX","deltaY","newX1","newY1","newX2","newY2","watch","isExpanded","applyCrop","cancelCrop","offsetX","offsetY","imgX1","imgY1","imgX2","imgY2","cropWidth","cropHeight","cropCanvas","rotateImageWrapper","flipImageHorizontalWrapper","flipImageVerticalWrapper","resetAdjustments","resetTransformationsWrapper","toggleSection","section","handleResizeWidthChangeWrapper","handleResizeHeightChangeWrapper","applyResizeWrapper","exportImageWrapper","handleSave","dataUrl","handleCancel","historyTimeout","handleResize","handleScroll","onMounted","onUnmounted","_openBlock","_createElementBlock","_hoisted_1","_hoisted_2","_createElementVNode","_hoisted_3","_hoisted_4","_createVNode","AppIcon","_hoisted_5","_toDisplayString","__","_hoisted_6","_normalizeStyle","AppButton","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_cache","$event","_normalizeClass","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","_hoisted_24","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","_hoisted_30","_hoisted_31","_hoisted_32","_hoisted_33","_hoisted_34","_hoisted_35","_hoisted_36","_hoisted_37","_hoisted_38","_hoisted_39","_hoisted_40","_hoisted_41","_hoisted_42","_hoisted_43","_hoisted_44","_hoisted_45","_hoisted_46","_hoisted_47","_hoisted_48","_hoisted_49","_hoisted_50","_hoisted_51","_hoisted_52","_hoisted_53","_hoisted_54","_hoisted_55","_hoisted_56","_hoisted_57","_hoisted_58","_hoisted_59","_hoisted_60","_hoisted_61","_hoisted_62","_hoisted_63","_hoisted_64","_hoisted_65","_hoisted_66","_hoisted_67","_hoisted_68","_hoisted_69","_hoisted_70","_hoisted_71","_Fragment","_renderList","preset","_hoisted_72","_hoisted_73","_hoisted_74","_hoisted_75","_hoisted_76","_hoisted_77","_hoisted_78","_hoisted_79","_hoisted_80","_hoisted_81","_hoisted_82","_hoisted_83","_hoisted_84","_hoisted_85","_hoisted_86","_hoisted_87","_createTextVNode","_hoisted_88","appStore","useAppStore","route","useRoute","router","useRouter","mediaItem","isSaving","getMediaItem","args","lmnFetch","notify","blob","editedFile","formData","formatFileSize","bytes","sizes","_b","_c","_d","_createBlock","ImageEditor"],"mappings":"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"}