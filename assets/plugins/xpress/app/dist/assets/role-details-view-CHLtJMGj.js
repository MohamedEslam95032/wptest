import{G as ve,u as me,U as fe,r as c,c as z,a as he,b as l,d as n,k as x,f as o,j as s,_ as v,t as i,F as L,g as m,W as P,Y as Z,h as w,D as C,e as ee,n as M,K as ge,I as we,J as ye,m as te,C as se,O as p,E as S}from"./_plugin-vue_export-helper-y4Xv5kKr.js";import{u as be,a as ke}from"./vue-router-mJSwnJkd.js";import{u as ze}from"../role-editor.build.Dj-keF7l.js";import{_ as Ce}from"./index-BaxaBONX.js";import{_ as Re}from"./index-9hv1rT8S.js";import{_ as Se}from"./index-DghDHKPv.js";import"./preload-helper-Dp1pzeXC.js";import"./index-C_FNz6s0.js";const Ae={class:"flex-1 flex flex-col h-full max-h-full overflow-hidden"},$e={key:0,class:"flex-1 flex items-center justify-center"},De={class:"text-center"},Ee={class:"w-12 h-12 rounded-full bg-zinc-100 dark:bg-zinc-900 flex items-center justify-center mx-auto mb-3"},Ne={class:"text-sm text-zinc-500 dark:text-zinc-400"},je={key:0,class:"mx-6 mt-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200/50 dark:border-red-800/30 rounded-xl flex items-start gap-3"},Ie={class:"flex-shrink-0 mt-0.5"},Ve={class:"flex-1 min-w-0"},Oe={class:"text-sm font-semibold text-red-900 dark:text-red-100 mb-1"},Te={class:"text-sm text-red-800 dark:text-red-200 leading-relaxed"},Be={class:"px-6 pt-6 pb-4 border-b border-zinc-200/50 dark:border-zinc-700/30"},Fe={class:"flex items-start justify-between mb-4"},Le={class:"flex-1"},Pe={class:"flex items-center gap-3 mb-2"},Me={key:0,class:"flex items-center gap-2 group"},Ue={class:"text-2xl font-semibold text-zinc-900 dark:text-zinc-100"},Ye=["title"],Ke={key:1,class:"flex items-center gap-2 flex-1 max-w-md"},We={key:2,class:"px-2 py-0.5 text-xs font-medium bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 rounded-md"},qe={class:"text-sm text-zinc-500 dark:text-zinc-400"},Ge={class:"flex items-center gap-3"},Je={class:"flex items-center gap-6 pt-4 border-t border-zinc-200/50 dark:border-zinc-700/30"},Qe={class:"flex items-center gap-2"},He={class:"text-xs font-medium text-zinc-600 dark:text-zinc-400"},Xe={class:"flex-1 max-w-xs"},Ze={class:"w-full bg-zinc-200 dark:bg-zinc-700 rounded-full h-1.5"},et={class:"px-6 py-4 border-b border-zinc-200/50 dark:border-zinc-700/30 bg-zinc-50/50 dark:bg-zinc-900/20"},tt={class:"relative"},st=["placeholder"],at={class:"flex-1 overflow-auto px-6 py-6 custom-scrollbar"},it={key:0,class:"text-center py-12"},rt={class:"w-12 h-12 bg-zinc-100 dark:bg-zinc-800 rounded-full flex items-center justify-center mx-auto mb-3"},nt={class:"text-sm font-medium text-zinc-900 dark:text-zinc-100 mb-1"},ot={class:"text-xs text-zinc-500 dark:text-zinc-400"},lt={key:1,class:"space-y-4"},dt=["onClick"],ct={class:"flex items-center gap-3"},ut={class:"font-semibold text-sm text-zinc-900 dark:text-zinc-100"},pt={class:"text-xs font-medium text-zinc-500 dark:text-zinc-400 bg-zinc-200 dark:bg-zinc-700 px-2 py-0.5 rounded"},_t={key:0,class:"text-xs font-medium text-green-600 dark:text-green-400 flex items-center gap-1"},xt={class:"flex items-center gap-2"},vt=["onClick","disabled"],mt=["onClick"],ft={key:0,class:"divide-y divide-zinc-100/50 dark:divide-zinc-800/30"},ht=["onClick"],gt={class:"flex-1 min-w-0"},wt={class:"text-sm font-medium text-zinc-900 dark:text-zinc-100 group-hover:text-zinc-700 dark:group-hover:text-zinc-200 transition-colors"},yt={class:"text-xs text-zinc-500 dark:text-zinc-400 font-mono mt-1 opacity-70"},bt={key:0,class:"px-6 py-4 border-t border-zinc-200/50 dark:border-zinc-700/30 bg-zinc-50 dark:bg-zinc-900/50 flex items-center justify-between shadow-lg"},kt={class:"flex items-center gap-3"},zt={class:"text-sm font-medium text-zinc-700 dark:text-zinc-300"},Ct={key:0,class:"px-2 py-0.5 text-xs font-medium bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 rounded"},Rt={class:"flex items-center gap-3"},St={__name:"role-details-view",setup(At){const U=me();ze();const A=be(),j=ke(),$=fe("refreshRolesList",null),I=c(!1),r=c(null),Y=c([]),f=c({}),u=c([]),h=c(!1),g=c(!1),y=c(""),D=c({}),V=c(null),E=c(!1),b=c(""),R=c(!1),N=c(!1),k=z(()=>{var e;return((e=r.value)==null?void 0:e.slug)==="administrator"}),K=z(()=>u.value.length),O=z(()=>Y.value.length),ae=z(()=>O.value===0?0:Math.round(K.value/O.value*100)),W=z(()=>{if(!y.value)return f.value;const e=y.value.toLowerCase(),t={};return Object.keys(f.value).forEach(a=>{const d=f.value[a].filter(_=>_.toLowerCase().includes(e));d.length>0&&(t[a]=d)}),t}),ie={general:(0,window.wp.i18n.__)("General","uixpress"),posts:(0,window.wp.i18n.__)("Posts","uixpress"),pages:(0,window.wp.i18n.__)("Pages","uixpress"),media:(0,window.wp.i18n.__)("Media","uixpress"),users:(0,window.wp.i18n.__)("Users","uixpress"),plugins:(0,window.wp.i18n.__)("Plugins","uixpress"),themes:(0,window.wp.i18n.__)("Themes","uixpress"),settings:(0,window.wp.i18n.__)("Settings","uixpress"),other:(0,window.wp.i18n.__)("Other","uixpress")},q=e=>!e||typeof e!="string"?!1:/^[a-z0-9_-]+$/.test(e),T=async()=>{if(A.params.roleSlug){if(!q(A.params.roleSlug)){p({title:(0,window.wp.i18n.__)("Invalid role format","uixpress"),type:"error"}),j.push({name:"role-editor"});return}I.value=!0,U.updateState("loading",!0);try{const e={endpoint:`uixpress/v1/role-editor/role/${A.params.roleSlug}`,params:{}},t=await S(e);if(!(t!=null&&t.data)){p({title:(0,window.wp.i18n.__)("Role not found","uixpress"),type:"error"}),j.push({name:"role-editor"});return}r.value=t.data,b.value=t.data.name,u.value=[...t.data.capabilities||[]],await re()}catch{p({title:(0,window.wp.i18n.__)("Failed to load role","uixpress"),type:"error"})}finally{I.value=!1,U.updateState("loading",!1)}}},re=async()=>{try{const t=await S({endpoint:"uixpress/v1/role-editor/capabilities",params:{}});t!=null&&t.data&&(Y.value=t.data.all||[],f.value=t.data.grouped||{},Object.keys(f.value).forEach(a=>{D.value[a]=!1}))}catch(e){console.error("Failed to fetch capabilities:",e)}},ne=e=>{const t=u.value.indexOf(e);t>-1?u.value.splice(t,1):u.value.push(e),h.value=!0},B=e=>u.value.includes(e),oe=e=>{D.value[e]=!D.value[e]},G=e=>D.value[e]===!0,le=()=>{E.value=!0,b.value=r.value.name},F=()=>{E.value=!1,b.value=r.value.name},de=e=>{if(!e||typeof e!="string")return!1;const t=e.trim();return t.length>0&&t.length<=100},J=async()=>{const e=b.value.trim();if(!e||e===r.value.name){F();return}if(!de(e)){p({title:(0,window.wp.i18n.__)("Invalid role name","uixpress"),message:(0,window.wp.i18n.__)("Role name must be between 1 and 100 characters.","uixpress"),type:"error"});return}R.value=!0;try{const t={endpoint:`uixpress/v1/role-editor/role/${r.value.slug}/name`,type:"POST",data:{name:e}},a=await S(t);a!=null&&a.data&&(r.value.name=a.data.name,E.value=!1,p({title:(0,window.wp.i18n.__)("Role name updated","uixpress"),type:"success"}),$&&await $())}catch{p({title:(0,window.wp.i18n.__)("Failed to update role name","uixpress"),type:"error"})}finally{R.value=!1}},ce=e=>{(f.value[e]||[]).forEach(a=>{u.value.includes(a)||u.value.push(a)}),h.value=!0},ue=e=>{(f.value[e]||[]).forEach(a=>{const d=u.value.indexOf(a);d>-1&&u.value.splice(d,1)}),h.value=!0},Q=e=>{const t=f.value[e]||[];return t.length>0&&t.every(a=>B(a))},pe=e=>Array.isArray(e)?e.every(t=>typeof t=="string"&&/^[a-z0-9_]+$/.test(t)):!1,H=async()=>{if(!(!h.value||!r.value)){if(!pe(u.value)){p({title:(0,window.wp.i18n.__)("Invalid capabilities format","uixpress"),type:"error"});return}if(!(k.value&&!await V.value.show({title:(0,window.wp.i18n.__)("Warning: Administrator Role","uixpress"),message:(0,window.wp.i18n.__)("You are about to modify the administrator role capabilities. This is extremely dangerous and could lock you out of your site permanently. Are you absolutely sure you want to proceed?","uixpress"),okButton:(0,window.wp.i18n.__)("Yes, I understand the risk","uixpress"),cancelButton:(0,window.wp.i18n.__)("Cancel","uixpress"),icon:"warning"}))){g.value=!0;try{const e={endpoint:`uixpress/v1/role-editor/role/${r.value.slug}`,type:"POST",data:{capabilities:u.value}},t=await S(e);t!=null&&t.data&&(p({title:(0,window.wp.i18n.__)("Capabilities updated","uixpress"),type:"success"}),h.value=!1,await T())}catch{p({title:(0,window.wp.i18n.__)("Failed to update capabilities","uixpress"),type:"error"})}finally{g.value=!1}}}},_e=e=>e.split("_").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" "),X=z(()=>!(!r.value||["administrator","editor","author","contributor","subscriber"].includes(r.value.slug)||r.value.userCount>0)),xe=async()=>{if(!r.value||!X.value)return;if(!q(r.value.slug)){p({title:(0,window.wp.i18n.__)("Invalid role format","uixpress"),type:"error"});return}if(await V.value.show({title:(0,window.wp.i18n.__)("Delete Role","uixpress"),message:(0,window.wp.i18n.__)('Are you sure you want to delete the role "%s"? This action cannot be undone.',"uixpress").replace("%s",r.value.name),okButton:(0,window.wp.i18n.__)("Delete","uixpress"),cancelButton:(0,window.wp.i18n.__)("Cancel","uixpress"),icon:"warning"})){N.value=!0;try{const t={endpoint:`uixpress/v1/role-editor/role/${r.value.slug}`,type:"DELETE"},a=await S(t);a!=null&&a.data&&(p({title:(0,window.wp.i18n.__)("Role deleted successfully","uixpress"),type:"success"}),$&&await $(),j.push({name:"role-editor"}))}catch{p({title:(0,window.wp.i18n.__)("Failed to delete role","uixpress"),type:"error"})}finally{N.value=!1}}};return he(()=>A.params.roleSlug,()=>{T()},{immediate:!0}),(e,t)=>(n(),l("div",Ae,[I.value?(n(),l("div",$e,[s("div",De,[s("div",Ee,[o(v,{icon:"people",class:"text-xl text-zinc-400 animate-pulse"})]),s("p",Ne,i(e.__("Loading...","uixpress")),1)])])):r.value?(n(),l(L,{key:1},[o(P,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"opacity-0 -translate-y-2","enter-to-class":"opacity-100 translate-y-0"},{default:m(()=>[k.value?(n(),l("div",je,[s("div",Ie,[o(v,{icon:"warning",class:"text-red-600 dark:text-red-400 text-xl"})]),s("div",Ve,[s("h3",Oe,i(e.__("Extreme Caution Required","uixpress")),1),s("p",Te,i(e.__("You are editing the Administrator role. Modifying capabilities incorrectly could permanently lock you out of your WordPress site. Only make changes if you are absolutely certain of what you are doing. It is strongly recommended to test changes on a staging site first.","uixpress")),1)])])):x("",!0)]),_:1}),s("div",Be,[s("div",Fe,[s("div",Le,[s("div",Pe,[E.value?(n(),l("div",Ke,[o(Ce,{modelValue:b.value,"onUpdate:modelValue":t[0]||(t[0]=a=>b.value=a),onKeyup:[Z(J,["enter"]),Z(F,["escape"])],class:"flex-1",disabled:R.value},null,8,["modelValue","disabled"]),o(C,{onClick:J,loading:R.value,type:"primary",class:"text-sm px-2 py-1"},{default:m(()=>[w(i(e.__("Save","uixpress")),1)]),_:1},8,["loading"]),o(C,{onClick:F,type:"default",class:"text-sm px-2 py-1",disabled:R.value},{default:m(()=>[w(i(e.__("Cancel","uixpress")),1)]),_:1},8,["disabled"])])):(n(),l("div",Me,[s("h2",Ue,i(r.value.name),1),s("button",{onClick:le,class:"opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded hover:bg-zinc-100 dark:hover:bg-zinc-800",title:e.__("Edit role name","uixpress")},[o(v,{icon:"edit",class:"text-sm text-zinc-500 dark:text-zinc-400"})],8,Ye)])),k.value?(n(),l("span",We,i(e.__("Admin","uixpress")),1)):x("",!0)]),s("p",qe,i(r.value.userCount)+" "+i(r.value.userCount===1?e.__("user","uixpress"):e.__("users","uixpress"))+" "+i(e.__("with this role","uixpress")),1)]),s("div",Ge,[X.value?(n(),ee(C,{key:0,onClick:xe,disabled:N.value||g.value,loading:N.value,type:"danger",class:"text-sm"},{default:m(()=>[o(v,{icon:"delete",class:"text-base"}),w(" "+i(e.__("Delete Role","uixpress")),1)]),_:1},8,["disabled","loading"])):x("",!0),o(C,{onClick:H,disabled:!h.value||g.value,loading:g.value,type:"primary",class:M(k.value?"border-red-300 dark:border-red-700":"")},{default:m(()=>[w(i(e.__("Save Changes","uixpress")),1)]),_:1},8,["disabled","loading","class"])])]),s("div",Je,[s("div",Qe,[s("div",{class:M(["w-2 h-2 rounded-full",h.value?"bg-amber-500 animate-pulse":"bg-green-500"])},null,2),s("span",He,i(K.value)+" / "+i(O.value)+" "+i(e.__("capabilities selected","uixpress")),1)]),s("div",Xe,[s("div",Ze,[s("div",{class:"bg-zinc-900 dark:bg-zinc-100 h-1.5 rounded-full transition-all duration-300",style:ge({width:`${ae.value}%`})},null,4)])])])]),s("div",et,[s("div",tt,[o(v,{icon:"search",class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-zinc-400 dark:text-zinc-500 text-base pointer-events-none"}),we(s("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>y.value=a),type:"text",placeholder:e.__("Search capabilities...","uixpress"),class:"w-full bg-white dark:bg-zinc-800 border border-zinc-200/50 dark:border-zinc-700/30 rounded-lg pl-10 pr-3 py-2.5 text-sm placeholder-zinc-400 dark:placeholder-zinc-500 focus:outline-none focus:ring-2 focus:ring-zinc-900 dark:focus:ring-zinc-100 focus:border-transparent transition-all"},null,8,st),[[ye,y.value]]),y.value?(n(),l("button",{key:0,onClick:t[2]||(t[2]=a=>y.value=""),class:"absolute right-3 top-1/2 transform -translate-y-1/2 text-zinc-400 dark:text-zinc-500 hover:text-zinc-600 dark:hover:text-zinc-400 transition-colors"},[o(v,{icon:"close",class:"text-sm"})])):x("",!0)])]),s("div",at,[Object.keys(W.value).length===0?(n(),l("div",it,[s("div",rt,[o(v,{icon:"search",class:"text-zinc-400 text-xl"})]),s("p",nt,i(e.__("No capabilities found","uixpress")),1),s("p",ot,i(e.__("Try adjusting your search terms","uixpress")),1)])):(n(),l("div",lt,[(n(!0),l(L,null,te(W.value,(a,d)=>(n(),l("div",{key:d,class:"border border-zinc-200/50 dark:border-zinc-700/30 rounded-xl overflow-hidden bg-white dark:bg-zinc-800/30"},[s("button",{onClick:_=>oe(d),class:"w-full px-4 py-3.5 bg-zinc-50 dark:bg-zinc-900/50 flex items-center justify-between hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors group"},[s("div",ct,[o(v,{icon:G(d)?"expand_less":"expand_more",class:"text-zinc-400 dark:text-zinc-500 transition-transform group-hover:text-zinc-600 dark:group-hover:text-zinc-400"},null,8,["icon"]),s("span",ut,i(ie[d]||d),1),s("span",pt,i(a.length),1),Q(d)?(n(),l("span",_t,[o(v,{icon:"check_circle",class:"text-xs"}),w(" "+i(e.__("All selected","uixpress")),1)])):x("",!0)]),s("div",xt,[s("button",{onClick:se(_=>ce(d),["stop"]),disabled:Q(d),class:"text-xs font-medium text-zinc-600 dark:text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-100 px-2.5 py-1 rounded-md hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},i(e.__("Select All","uixpress")),9,vt),s("button",{onClick:se(_=>ue(d),["stop"]),class:"text-xs font-medium text-zinc-600 dark:text-zinc-400 hover:text-zinc-900 dark:hover:text-zinc-100 px-2.5 py-1 rounded-md hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors"},i(e.__("Deselect All","uixpress")),9,mt)])],8,dt),o(P,{"enter-active-class":"transition-all duration-200 ease-out","enter-from-class":"opacity-0 max-h-0","enter-to-class":"opacity-100 max-h-[2000px]","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 max-h-[2000px]","leave-to-class":"opacity-0 max-h-0"},{default:m(()=>[G(d)?(n(),l("div",ft,[(n(!0),l(L,null,te(a,_=>(n(),l("label",{key:_,class:"flex items-center gap-3 px-4 py-3 hover:bg-zinc-50 dark:hover:bg-zinc-900/50 transition-colors cursor-pointer group",onClick:$t=>ne(_)},[o(Re,{checked:B(_),class:"flex-shrink-0"},null,8,["checked"]),s("div",gt,[s("div",wt,i(_e(_)),1),s("div",yt,i(_),1)]),B(_)?(n(),ee(v,{key:0,icon:"check_circle",class:"text-green-500 dark:text-green-400 flex-shrink-0 opacity-0 group-hover:opacity-100 transition-opacity"})):x("",!0)],8,ht))),128))])):x("",!0)]),_:2},1024)]))),128))]))]),o(P,{"enter-active-class":"transition-all duration-200 ease-out","enter-from-class":"opacity-0 translate-y-2","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 translate-y-2"},{default:m(()=>[h.value?(n(),l("div",bt,[s("div",kt,[t[3]||(t[3]=s("div",{class:"w-2 h-2 bg-amber-500 rounded-full animate-pulse"},null,-1)),s("p",zt,i(e.__("You have unsaved changes","uixpress")),1),k.value?(n(),l("span",Ct,i(e.__("Admin Role","uixpress")),1)):x("",!0)]),s("div",Rt,[o(C,{onClick:T,type:"default",disabled:g.value},{default:m(()=>[w(i(e.__("Cancel","uixpress")),1)]),_:1},8,["disabled"]),o(C,{onClick:H,type:"primary",loading:g.value,class:M(k.value?"bg-red-600 hover:bg-red-700 dark:bg-red-700 dark:hover:bg-red-800":"")},{default:m(()=>[w(i(e.__("Save Changes","uixpress")),1)]),_:1},8,["loading","class"])])])):x("",!0)]),_:1})],64)):x("",!0),o(Se,{ref_key:"confirmDialog",ref:V},null,512)]))}},Bt=ve(St,[["__scopeId","data-v-c6e5ad50"]]);export{Bt as default};
//# sourceMappingURL=role-details-view-CHLtJMGj.js.map
