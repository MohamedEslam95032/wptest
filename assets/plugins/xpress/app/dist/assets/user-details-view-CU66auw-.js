import{u as X,a as ee}from"./vue-router-mJSwnJkd.js";import{u as te,r,c as C,o as se,a as ae,b as i,d,k as D,j as a,f as u,_ as I,t as l,F as Z,g as le,h as B,D as oe,m as ne,n as re,E as $,O as T}from"./_plugin-vue_export-helper-y4Xv5kKr.js";import{_ as g}from"./index-BaxaBONX.js";import{_ as ie}from"./index-xR3ssTK5.js";import{_ as de}from"./index-B-3JnImM.js";import{_ as ue}from"./index-Be1QSod0.js";const ce={class:"flex-1 flex flex-col h-full max-h-full overflow-hidden"},pe={key:0,class:"flex-1 flex items-center justify-center"},me={class:"text-center"},_e={class:"w-12 h-12 rounded-full bg-zinc-100 dark:bg-zinc-900 flex items-center justify-center mx-auto mb-3"},xe={class:"text-sm text-zinc-500 dark:text-zinc-400"},fe={class:"flex-shrink-0 px-6 py-4 border-b border-zinc-200 dark:border-zinc-800 bg-white dark:bg-zinc-800/30"},ge={class:"flex items-center gap-4"},be={class:"w-16 h-16 bg-zinc-200 dark:bg-zinc-800 rounded-full overflow-hidden flex-shrink-0"},ve=["src","alt"],he={key:1,class:"w-full h-full flex items-center justify-center"},ke={class:"flex-1 min-w-0"},we={class:"text-lg font-semibold text-zinc-900 dark:text-zinc-100 mb-1 truncate"},ze={class:"text-sm text-zinc-500 dark:text-zinc-400 truncate"},ye={class:"flex-shrink-0 text-right text-xs text-zinc-500 dark:text-zinc-400"},Ve={class:"mt-1"},Ue={class:"flex-1 overflow-auto"},De={class:"p-6 space-y-6 max-w-2xl"},Ie={class:"block text-[10px] uppercase tracking-wider font-semibold text-zinc-400 dark:text-zinc-500 mb-2"},$e={class:"block text-[10px] uppercase tracking-wider font-semibold text-zinc-400 dark:text-zinc-500 mb-2"},je={class:"block text-[10px] uppercase tracking-wider font-semibold text-zinc-400 dark:text-zinc-500 mb-2"},Ae={class:"text-xs text-zinc-500 dark:text-zinc-400 mt-1"},Ne={class:"block text-[10px] uppercase tracking-wider font-semibold text-zinc-400 dark:text-zinc-500 mb-2"},Re={class:"block text-[10px] uppercase tracking-wider font-semibold text-zinc-400 dark:text-zinc-500 mb-2"},Fe={class:"block text-[10px] uppercase tracking-wider font-semibold text-zinc-400 dark:text-zinc-500 mb-2"},Ce={class:"block text-[10px] uppercase tracking-wider font-semibold text-zinc-400 dark:text-zinc-500 mb-2"},Te={class:"pt-4 border-t border-zinc-100 dark:border-zinc-800"},Le={class:"flex flex-col gap-3"},Me={class:"flex-1"},Ee={class:"block text-sm font-medium text-zinc-700 dark:text-zinc-300 mb-1",for:"send-notification"},Ze={class:"text-xs text-zinc-500 dark:text-zinc-400"},Be={class:"pt-4 border-t border-zinc-100 dark:border-zinc-800"},Oe={key:0,class:"pt-6 border-t border-zinc-100 dark:border-zinc-800"},Pe={class:"flex items-center justify-between mb-4"},We={class:"block text-[10px] uppercase tracking-wider font-semibold text-zinc-400 dark:text-zinc-500"},Se={key:0,class:"py-4 text-center"},Ye={key:1,class:"space-y-2"},He=["onClick"],Je={class:"flex-1 min-w-0 text-xs text-zinc-600 dark:text-zinc-400"},qe={class:"font-medium"},Ge={key:0},Ke={key:1,class:"text-zinc-500 dark:text-zinc-500"},Qe={class:"text-xs text-zinc-500 dark:text-zinc-500 flex-shrink-0"},Xe={key:2,class:"py-4 text-center text-sm text-zinc-500 dark:text-zinc-400"},rt={__name:"user-details-view",setup(et){const c=te(),m=X(),O=ee(),j=r(!1),o=r(null),b=r(!1),v=r([]),h=r([]),A=r(!1),k=C(()=>{var e;return((e=c.state.uixpress_settings)==null?void 0:e.enable_activity_logger)===!0}),p=r(""),_=r(""),w=r(""),z=r(""),y=r(""),x=r(""),V=r([]),L=r(!1),P=C(()=>v.value.map(e=>({id:e.slug,name:e.name,slug:e.slug}))),W=C(()=>V.value.map(e=>e.slug)),N=async()=>{if(!m.params.userId)return;j.value=!0,c.updateState("loading",!0);const e={endpoint:`wp/v2/users/${m.params.userId}`,params:{context:"edit"}},t=await $(e);if(j.value=!1,c.updateState("loading",!1),!(t!=null&&t.data)){T({title:(0,window.wp.i18n.__)("User not found","uixpress"),type:"error"}),O.push("/");return}o.value=t.data,p.value=o.value.name||"",_.value=o.value.email||"",w.value=o.value.slug||"",z.value=o.value.url||"",y.value=o.value.description||"";const n=o.value.roles||[];V.value=v.value.filter(s=>n.includes(s.slug)).map(s=>({id:s.slug,name:s.name,slug:s.slug}))},M=async()=>{try{const e=await $({endpoint:"uixpress/v1/user-roles"});e!=null&&e.data&&(v.value=e.data.map(t=>({slug:t.value,name:t.label})))}catch(e){console.error("Failed to fetch roles:",e)}},S=async()=>{if(!o.value)return;b.value=!0,c.updateState("loading",!0);const e={name:p.value,email:_.value,url:z.value,description:y.value,roles:W.value};x.value&&(e.password=x.value);try{const t={endpoint:`wp/v2/users/${o.value.id}`,type:"POST",params:{context:"edit"},data:e},n=await $(t);n!=null&&n.data&&(T({title:(0,window.wp.i18n.__)("User updated successfully","uixpress"),type:"success"}),await N(),x.value="")}catch{T({title:(0,window.wp.i18n.__)("Failed to update user","uixpress"),type:"error"})}finally{b.value=!1,c.updateState("loading",!1)}},Y=e=>e?new Date(e).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"}):"—",H=e=>{if(!e)return null;if(e.match(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/))return new Date(e+"Z");if(e.includes("T")&&(e.endsWith("Z")||e.match(/[+-]\d{2}:\d{2}$/)))return new Date(e);if(e.includes("T")&&!e.endsWith("Z")&&!e.match(/[+-]\d{2}:\d{2}$/))return new Date(e+"Z");const t=new Date(e);return isNaN(t.getTime())&&e.match(/^\d{4}-\d{2}-\d{2}/)?new Date(e+"Z"):t},J=e=>{if(!e)return"—";const t=H(e);if(!t||isNaN(t.getTime()))return"—";const n=new Date,s=Math.floor((n-t)/1e3);if(s<60)return(0,window.wp.i18n.__)("Just now","uixpress");const f=Math.floor(s/60);if(f<60)return f===1?(0,window.wp.i18n.__)("1 minute ago","uixpress"):(0,window.wp.i18n.__)("%d minutes ago","uixpress").replace("%d",f);const U=Math.floor(f/60);if(U<24)return U===1?(0,window.wp.i18n.__)("1 hour ago","uixpress"):(0,window.wp.i18n.__)("%d hours ago","uixpress").replace("%d",U);const F=Math.floor(U/24);return F<7?F===1?(0,window.wp.i18n.__)("1 day ago","uixpress"):(0,window.wp.i18n.__)("%d days ago","uixpress").replace("%d",F):t.toLocaleDateString(void 0,{month:"short",day:"numeric",year:t.getFullYear()!==n.getFullYear()?"numeric":void 0})},q=e=>({created:"add",updated:"edit",deleted:"delete",trashed:"delete",restored:"restore",activated:"check_circle",deactivated:"cancel",installed:"download",login:"login",logout:"logout",role_changed:"admin_users",status_changed:"flag",uploaded:"upload"})[e]||"info",G=e=>({created:"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400",updated:"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400",deleted:"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400",trashed:"bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-400",restored:"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400",activated:"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400",deactivated:"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400",installed:"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400",login:"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400",logout:"bg-zinc-100 dark:bg-zinc-800 text-zinc-700 dark:text-zinc-400",role_changed:"bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400",status_changed:"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400",uploaded:"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400"})[e]||"bg-zinc-100 dark:bg-zinc-800 text-zinc-700 dark:text-zinc-400",R=e=>{var t,n,s;return(t=e.metadata)!=null&&t.title?e.metadata.title:(n=e.new_value)!=null&&n.title?e.new_value.title:(s=e.old_value)!=null&&s.title?e.old_value.title:e.object_id?`${e.object_type} #${e.object_id}`:e.object_type},E=async()=>{if(!(!k.value||!m.params.userId)){A.value=!0;try{const e={endpoint:"uixpress/v1/activity-log",params:{user_id:m.params.userId,per_page:10,orderby:"created_at",order:"DESC"}},t=await $(e);t!=null&&t.data&&(h.value=t.data)}catch(e){console.error("Failed to fetch user activities:",e),h.value=[]}finally{A.value=!1}}},K=e=>`${c.state.adminUrl||""}admin.php?page=uixpress-activity-log#/details/${e}`,Q=e=>{const t=K(e.id);window.open(t,"_blank")};return se(async()=>{await M(),await N(),k.value&&await E()}),ae(()=>m.params.userId,async e=>{e&&(v.value.length===0&&await M(),await N(),k.value&&await E())}),(e,t)=>{var n;return d(),i("div",ce,[j.value?(d(),i("div",pe,[a("div",me,[a("div",_e,[u(I,{icon:"person",class:"text-xl text-zinc-400 animate-pulse"})]),a("p",xe,l(e.__("Loading...","uixpress")),1)])])):o.value?(d(),i(Z,{key:1},[a("div",fe,[a("div",ge,[a("div",be,[(n=o.value.avatar_urls)!=null&&n["96"]?(d(),i("img",{key:0,src:o.value.avatar_urls[96],alt:p.value,class:"w-full h-full object-cover"},null,8,ve)):(d(),i("div",he,[u(I,{icon:"person",class:"text-2xl text-zinc-500 dark:text-zinc-400"})]))]),a("div",ke,[a("h2",we,l(p.value||w.value),1),a("p",ze,l(_.value),1)]),a("div",ye,[a("div",null,l(e.__("User ID","uixpress"))+": "+l(o.value.id),1),a("div",Ve,l(e.__("Registered","uixpress"))+" "+l(Y(o.value.registered_date)),1)])])]),a("div",Ue,[a("div",De,[a("div",null,[a("label",Ie,l(e.__("Name","uixpress")),1),u(g,{modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=s=>p.value=s),placeholder:e.__("User name","uixpress"),autocomplete:"off"},null,8,["modelValue","placeholder"])]),a("div",null,[a("label",$e,l(e.__("Email","uixpress")),1),u(g,{modelValue:_.value,"onUpdate:modelValue":t[1]||(t[1]=s=>_.value=s),type:"email",placeholder:e.__("user@example.com","uixpress"),autocomplete:"off"},null,8,["modelValue","placeholder"])]),a("div",null,[a("label",je,l(e.__("Username","uixpress")),1),u(g,{modelValue:w.value,"onUpdate:modelValue":t[2]||(t[2]=s=>w.value=s),disabled:!0,placeholder:e.__("Username","uixpress"),autocomplete:"off"},null,8,["modelValue","placeholder"]),a("p",Ae,l(e.__("Username cannot be changed","uixpress")),1)]),a("div",null,[a("label",Ne,l(e.__("Website","uixpress")),1),u(g,{modelValue:z.value,"onUpdate:modelValue":t[3]||(t[3]=s=>z.value=s),type:"url",placeholder:e.__("https://example.com","uixpress"),autocomplete:"off"},null,8,["modelValue","placeholder"])]),a("div",null,[a("label",Re,l(e.__("Biographical Info","uixpress")),1),u(ie,{modelValue:y.value,"onUpdate:modelValue":t[4]||(t[4]=s=>y.value=s),placeholder:e.__("About the user","uixpress"),rows:4,autocomplete:"off"},null,8,["modelValue","placeholder"])]),a("div",null,[a("label",Fe,l(e.__("New Password","uixpress")),1),u(g,{modelValue:x.value,"onUpdate:modelValue":t[5]||(t[5]=s=>x.value=s),type:"password",placeholder:e.__("Leave blank to keep current password","uixpress"),autocomplete:"new-password"},null,8,["modelValue","placeholder"])]),a("div",null,[a("label",Ce,l(e.__("Roles","uixpress")),1),u(ue,{modelValue:V.value,"onUpdate:modelValue":t[6]||(t[6]=s=>V.value=s),"available-tags":P.value,disabled:b.value,placeholder:e.__("Add roles...","uixpress"),"allow-create":!1},null,8,["modelValue","available-tags","disabled","placeholder"])]),a("div",Te,[a("div",Le,[a("div",Me,[a("label",Ee,l(e.__("Send user notification","uixpress")),1),a("p",Ze,l(e.__("Send an email notification to the user about the changes.","uixpress")),1)]),u(de,{modelValue:L.value,"onUpdate:modelValue":t[7]||(t[7]=s=>L.value=s),id:"send-notification",class:"w-auto"},null,8,["modelValue"])])]),a("div",Be,[u(oe,{type:"primary",onClick:S,loading:b.value},{default:le(()=>[B(l(e.__("Update User","uixpress")),1)]),_:1},8,["loading"])]),k.value?(d(),i("div",Oe,[a("div",Pe,[a("label",We,l(e.__("Recent Activity","uixpress")),1)]),A.value?(d(),i("div",Se,[u(I,{icon:"refresh",class:"text-lg text-zinc-400 dark:text-zinc-500 animate-spin mx-auto"})])):h.value.length>0?(d(),i("div",Ye,[(d(!0),i(Z,null,ne(h.value,s=>(d(),i("div",{key:s.id,onClick:f=>Q(s),class:"flex items-center gap-2.5 px-3 py-2 rounded-lg hover:bg-zinc-50 dark:hover:bg-zinc-800/50 transition-colors cursor-pointer"},[a("span",{class:re(["px-2 py-0.5 text-[10px] font-medium rounded uppercase flex items-center gap-1 flex-shrink-0",G(s.action)])},[u(I,{icon:q(s.action),class:"text-[10px]"},null,8,["icon"]),B(" "+l(s.action),1)],2),a("div",Je,[a("span",qe,l(s.object_type),1),s.object_id?(d(),i("span",Ge," #"+l(s.object_id),1)):D("",!0),R(s)&&R(s)!==s.object_type?(d(),i("span",Ke," : "+l(R(s)),1)):D("",!0)]),a("span",Qe,l(J(s.created_at)),1)],8,He))),128))])):(d(),i("div",Xe,l(e.__("No recent activity","uixpress")),1))])):D("",!0)])])],64)):D("",!0)])}}};export{rt as default};
//# sourceMappingURL=user-details-view-CU66auw-.js.map
