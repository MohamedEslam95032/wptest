{"version":3,"file":"query-editor-DkngT3ee.js","sources":["../../src/pages/database/src/query-editor.vue"],"sourcesContent":["<script setup>\nimport { ref, onMounted } from 'vue';\nimport { useRouter } from 'vue-router';\n\n// Store\nimport { useAppStore } from '@/store/app/app.js';\nconst appStore = useAppStore();\n\n// Funcs\nimport { lmnFetch } from '@/assets/js/functions/lmnFetch.js';\nimport { notify } from '@/assets/js/functions/notify.js';\n\n// Comps\nimport AppIcon from '@/components/utility/icons/index.vue';\nimport AppButton from '@/components/utility/app-button/index.vue';\n\nconst router = useRouter();\n\n// Refs\nconst query = ref('SELECT * FROM wp_posts LIMIT 100;');\nconst loading = ref(false);\nconst results = ref([]);\nconst queryHistory = ref([]);\nconst showHistory = ref(false);\n\n/**\n * Executes the SQL query\n */\nconst executeQuery = async () => {\n  if (!query.value.trim()) {\n    notify({\n      title: __('Please enter a SQL query', 'uixpress'),\n      type: 'warning',\n    });\n    return;\n  }\n\n  loading.value = true;\n  results.value = [];\n\n  try {\n    const args = {\n      endpoint: 'uixpress/v1/database/query',\n      type: 'POST',\n      data: {\n        query: query.value.trim(),\n        limit: 1000,\n      },\n    };\n    const data = await lmnFetch(args);\n    if (data && data.data) {\n      results.value = data.data.data || [];\n      \n      // Add to history\n      queryHistory.value.unshift({\n        query: query.value.trim(),\n        timestamp: new Date().toISOString(),\n        rows: data.data.rows_affected || 0,\n      });\n      \n      // Keep only last 20 queries\n      if (queryHistory.value.length > 20) {\n        queryHistory.value = queryHistory.value.slice(0, 20);\n      }\n      \n      notify({\n        title: sprintf(__('Query executed successfully. %d rows returned.', 'uixpress'), results.value.length),\n        type: 'success',\n      });\n    }\n  } catch (error) {\n    notify({\n      title: error.message || __('Error executing query', 'uixpress'),\n      type: 'error',\n    });\n    console.error('Error executing query:', error);\n  } finally {\n    loading.value = false;\n  }\n};\n\n/**\n * Loads a query from history\n * @param {Object} historyItem - The history item to load\n */\nconst loadFromHistory = (historyItem) => {\n  query.value = historyItem.query;\n  showHistory.value = false;\n};\n\n/**\n * Clears the query editor\n */\nconst clearQuery = () => {\n  query.value = '';\n  results.value = [];\n};\n\n/**\n * Escapes HTML to prevent XSS attacks\n * @param {string} text - The text to escape\n * @returns {string} Escaped HTML string\n */\nconst escapeHtml = (text) => {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n};\n\n/**\n * Gets column display value (escaped for safety)\n * @param {*} value - The value to display\n * @returns {string} Formatted and escaped value\n */\nconst getDisplayValue = (value) => {\n  if (value === null || value === undefined) {\n    return '<span class=\"text-zinc-400 italic\">NULL</span>';\n  }\n  if (typeof value === 'object') {\n    return escapeHtml(JSON.stringify(value));\n  }\n  return escapeHtml(String(value));\n};\n\n/**\n * Handles keyboard shortcuts\n * @param {KeyboardEvent} event - Keyboard event\n */\nconst handleKeyDown = (event) => {\n  // Ctrl/Cmd + Enter to execute\n  if ((event.ctrlKey || event.metaKey) && event.key === 'Enter') {\n    event.preventDefault();\n    executeQuery();\n  }\n};\n\nonMounted(() => {\n  // Load sample query\n  query.value = 'SELECT * FROM wp_posts LIMIT 100;';\n});\n</script>\n\n<template>\n  <div class=\"flex flex-col h-full bg-white dark:bg-zinc-900\">\n    <!-- Header -->\n    <div\n      class=\"flex items-center justify-between px-6 py-4 border-b border-zinc-200 dark:border-zinc-800\"\n    >\n      <div class=\"flex items-center gap-4\">\n        <AppButton\n          @click=\"router.push('/')\"\n          type=\"transparent\"\n          class=\"p-2\"\n        >\n          <AppIcon icon=\"arrow_back\" class=\"text-base\" />\n        </AppButton>\n        <div>\n          <h2 class=\"text-lg font-semibold text-zinc-900 dark:text-zinc-100\">\n            {{ __('SQL Query Editor', 'uixpress') }}\n          </h2>\n          <p class=\"text-sm text-zinc-500 dark:text-zinc-400\">\n            {{ __('Execute SELECT queries only (read-only for safety)', 'uixpress') }}\n          </p>\n        </div>\n      </div>\n\n      <div class=\"flex items-center gap-2\">\n        <AppButton\n          @click=\"showHistory = !showHistory\"\n          type=\"transparent\"\n          class=\"text-sm\"\n        >\n          <AppIcon icon=\"history\" class=\"text-base mr-2\" />\n          {{ __('History', 'uixpress') }}\n        </AppButton>\n        <AppButton @click=\"clearQuery\" type=\"transparent\" class=\"text-sm\">\n          {{ __('Clear', 'uixpress') }}\n        </AppButton>\n        <AppButton\n          @click=\"executeQuery\"\n          :disabled=\"loading || !query.trim()\"\n          type=\"primary\"\n          class=\"text-sm\"\n        >\n          <AppIcon icon=\"play_arrow\" class=\"text-base mr-2\" />\n          {{ __('Execute', 'uixpress') }}\n          <span class=\"ml-2 text-xs opacity-70\">(Ctrl+Enter)</span>\n        </AppButton>\n      </div>\n    </div>\n\n    <!-- Query History Sidebar -->\n    <Transition>\n      <div\n        v-if=\"showHistory\"\n        class=\"absolute right-0 top-0 bottom-0 w-80 bg-white dark:bg-zinc-900 border-l border-zinc-200 dark:border-zinc-800 z-10 overflow-y-auto\"\n      >\n        <div class=\"p-4 border-b border-zinc-200 dark:border-zinc-800\">\n          <div class=\"flex items-center justify-between\">\n            <h3 class=\"text-sm font-semibold text-zinc-900 dark:text-zinc-100\">\n              {{ __('Query History', 'uixpress') }}\n            </h3>\n            <AppButton\n              @click=\"showHistory = false\"\n              type=\"transparent\"\n              class=\"p-1\"\n            >\n              <AppIcon icon=\"close\" class=\"text-base\" />\n            </AppButton>\n          </div>\n        </div>\n        <div class=\"p-2\">\n          <div\n            v-if=\"queryHistory.length === 0\"\n            class=\"p-4 text-center text-sm text-zinc-500 dark:text-zinc-400\"\n          >\n            {{ __('No query history', 'uixpress') }}\n          </div>\n          <div\n            v-for=\"(item, index) in queryHistory\"\n            :key=\"index\"\n            @click=\"loadFromHistory(item)\"\n            class=\"p-3 rounded-lg cursor-pointer hover:bg-zinc-100 dark:hover:bg-zinc-800 mb-2 transition-colors\"\n          >\n            <div class=\"text-xs text-zinc-500 dark:text-zinc-400 mb-1\">\n              {{ new Date(item.timestamp).toLocaleString() }}\n            </div>\n            <div class=\"text-sm text-zinc-900 dark:text-zinc-100 font-mono truncate\">\n              {{ item.query }}\n            </div>\n            <div class=\"text-xs text-zinc-500 dark:text-zinc-400 mt-1\">\n              {{ item.rows }} {{ __('rows', 'uixpress') }}\n            </div>\n          </div>\n        </div>\n      </div>\n    </Transition>\n\n    <!-- Main Content -->\n    <div class=\"flex flex-1 overflow-hidden\">\n      <!-- Query Editor -->\n      <div class=\"flex-1 flex flex-col border-r border-zinc-200 dark:border-zinc-800\">\n        <div class=\"px-4 py-2 border-b border-zinc-200 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-800\">\n          <span class=\"text-xs font-medium text-zinc-500 dark:text-zinc-400\">\n            {{ __('SQL Query', 'uixpress') }}\n          </span>\n        </div>\n        <textarea\n          v-model=\"query\"\n          @keydown=\"handleKeyDown\"\n          class=\"flex-1 p-4 font-mono text-sm bg-transparent text-zinc-900 dark:text-zinc-100 resize-none focus:outline-none\"\n          :placeholder=\"__('Enter your SELECT query here...', 'uixpress')\"\n        ></textarea>\n      </div>\n\n      <!-- Results -->\n      <div class=\"flex-1 flex flex-col overflow-hidden\">\n        <div class=\"px-4 py-2 border-b border-zinc-200 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-800\">\n          <span class=\"text-xs font-medium text-zinc-500 dark:text-zinc-400\">\n            {{ __('Results', 'uixpress') }}\n            <span v-if=\"results.length > 0\" class=\"ml-2\">\n              ({{ results.length }} {{ __('rows', 'uixpress') }})\n            </span>\n          </span>\n        </div>\n        <div class=\"flex-1 overflow-auto p-4\">\n          <div v-if=\"loading\" class=\"space-y-4\">\n            <div\n              v-for=\"i in 5\"\n              :key=\"i\"\n              class=\"h-12 rounded-lg bg-zinc-100 dark:bg-zinc-800 animate-pulse\"\n            ></div>\n          </div>\n\n          <div v-else-if=\"results.length === 0\" class=\"text-center py-12\">\n            <AppIcon\n              icon=\"database\"\n              class=\"text-4xl text-zinc-300 dark:text-zinc-700 mx-auto mb-4\"\n            />\n            <p class=\"text-sm text-zinc-500 dark:text-zinc-400\">\n              {{ __('No results yet. Execute a query to see results.', 'uixpress') }}\n            </p>\n          </div>\n\n          <div v-else class=\"overflow-x-auto\">\n            <table class=\"w-full\">\n              <thead class=\"bg-zinc-50 dark:bg-zinc-800 sticky top-0\">\n                <tr>\n                  <th\n                    v-for=\"column in Object.keys(results[0] || {})\"\n                    :key=\"column\"\n                    class=\"px-4 py-3 text-left text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase\"\n                  >\n                    {{ column }}\n                  </th>\n                </tr>\n              </thead>\n              <tbody class=\"divide-y divide-zinc-200 dark:divide-zinc-800\">\n                <tr\n                  v-for=\"(row, index) in results\"\n                  :key=\"index\"\n                  class=\"hover:bg-zinc-50 dark:hover:bg-zinc-800 transition-colors\"\n                >\n                  <td\n                    v-for=\"(value, column) in row\"\n                    :key=\"column\"\n                    class=\"px-4 py-3 text-sm text-zinc-900 dark:text-zinc-100 max-w-xs truncate\"\n                    :title=\"getDisplayValue(value)\"\n                  >\n                    <span v-html=\"getDisplayValue(value)\"></span>\n                  </td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<style scoped>\n/* Custom scrollbar */\n.overflow-auto::-webkit-scrollbar {\n  width: 8px;\n  height: 8px;\n}\n\n.overflow-auto::-webkit-scrollbar-track {\n  @apply bg-transparent;\n}\n\n.overflow-auto::-webkit-scrollbar-thumb {\n  @apply bg-zinc-300 dark:bg-zinc-700 rounded-full;\n}\n\n.overflow-auto::-webkit-scrollbar-thumb:hover {\n  @apply bg-zinc-400 dark:bg-zinc-600;\n}\n\n/* Transition for history sidebar */\n.v-enter-active,\n.v-leave-active {\n  transition: transform 0.2s ease-in-out;\n}\n\n.v-enter-from {\n  transform: translateX(100%);\n}\n\n.v-leave-to {\n  transform: translateX(100%);\n}\n</style>\n\n"],"names":["useAppStore","router","useRouter","query","ref","loading","results","queryHistory","showHistory","executeQuery","notify","args","data","lmnFetch","error","loadFromHistory","historyItem","clearQuery","escapeHtml","text","div","getDisplayValue","value","handleKeyDown","event","onMounted","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_createVNode","AppButton","_cache","$event","_unref","AppIcon","_hoisted_4","_toDisplayString","__","_hoisted_5","_hoisted_6","_createTextVNode","_Transition","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_Fragment","_renderList","item","index","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_22","_hoisted_23","_hoisted_24","_hoisted_25","_hoisted_26","_hoisted_27","i","_hoisted_28","_hoisted_29","_hoisted_30","_hoisted_31","_hoisted_32","column","_hoisted_33","row"],"mappings":"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"}