import{G as ee,u as te,r as l,a as M,b as o,d as n,j as t,f as d,k as h,t as i,g as y,h as N,_ as z,D as S,n as O,F as m,m as g,I as U,J as H,e as se,Y as ae,E as D,O as v}from"./_plugin-vue_export-helper-y4Xv5kKr.js";import{u as ie,a as ne}from"./vue-router-mJSwnJkd.js";import{M as oe,_ as re}from"./index-DghDHKPv.js";const le={class:"flex flex-col h-full overflow-hidden"},de={class:"px-6 pt-6 pb-4 border-b border-zinc-200/40 dark:border-zinc-700/30"},ce={class:"flex items-center justify-between mb-4"},ue={class:"text-xl font-medium text-zinc-900 dark:text-zinc-100 mb-1"},pe={key:0,class:"text-sm text-zinc-500 dark:text-zinc-400"},xe={key:0},_e={class:"flex items-center gap-2"},ve={key:0,class:"flex-1 overflow-auto p-6"},fe={key:0,class:"space-y-4"},be={key:1},he={class:"mb-8"},ye={class:"text-sm font-semibold text-zinc-900 dark:text-zinc-100 mb-4 uppercase tracking-wider text-[10px] text-zinc-500 dark:text-zinc-400"},ze={class:"border border-zinc-200/40 dark:border-zinc-700/30 rounded-xl overflow-hidden"},me={class:"w-full"},ge={class:"bg-zinc-50 dark:bg-zinc-900/50"},we={class:"px-4 py-3 text-left text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase"},ke={class:"px-4 py-3 text-left text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase"},Ce={class:"px-4 py-3 text-left text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase"},Te={class:"px-4 py-3 text-left text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase"},Se={class:"px-4 py-3 text-left text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase"},De={class:"divide-y divide-zinc-200/40 dark:divide-zinc-700/30"},Ee={class:"px-4 py-3 text-sm font-medium text-zinc-900 dark:text-zinc-100"},$e={class:"px-4 py-3 text-sm text-zinc-600 dark:text-zinc-400"},Ne={class:"px-4 py-3 text-sm text-zinc-600 dark:text-zinc-400"},Me={class:"px-4 py-3 text-sm text-zinc-600 dark:text-zinc-400"},Ve={key:0,class:"px-2 py-1 text-xs rounded bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300"},Pe={class:"px-4 py-3 text-sm text-zinc-600 dark:text-zinc-400"},Le={key:0},Ae={class:"text-sm font-semibold text-zinc-900 dark:text-zinc-100 mb-4 uppercase tracking-wider text-[10px] text-zinc-500 dark:text-zinc-400"},Fe={class:"border border-zinc-200/40 dark:border-zinc-700/30 rounded-xl overflow-hidden"},Ie={class:"w-full"},Ke={class:"bg-zinc-50 dark:bg-zinc-900/50"},je={class:"px-4 py-3 text-left text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase"},Be={class:"px-4 py-3 text-left text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase"},Oe={class:"px-4 py-3 text-left text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase"},Ue={class:"divide-y divide-zinc-200/40 dark:divide-zinc-700/30"},He={class:"px-4 py-3 text-sm font-medium text-zinc-900 dark:text-zinc-100"},Ye={class:"px-4 py-3 text-sm text-zinc-600 dark:text-zinc-400"},Je={class:"px-4 py-3 text-sm text-zinc-600 dark:text-zinc-400"},Re={key:1,class:"flex flex-col flex-1 overflow-hidden"},We={class:"px-6 py-4 border-b border-zinc-200/40 dark:border-zinc-700/30"},qe={class:"relative max-w-md"},Ge=["placeholder"],Qe={class:"flex-1 overflow-auto"},Xe={key:0,class:"p-6 space-y-4"},Ze={key:1,class:"p-6 text-center"},et={class:"text-sm text-zinc-500 dark:text-zinc-400"},tt={key:2,class:"overflow-x-auto"},st={class:"w-full"},at={class:"bg-zinc-50 dark:bg-zinc-900/50 sticky top-0"},it=["onClick"],nt={class:"flex items-center gap-2"},ot={class:"divide-y divide-zinc-200/40 dark:divide-zinc-700/30"},rt=["title"],lt=["innerHTML"],dt={key:0,class:"flex items-center justify-between px-6 py-4 border-t border-zinc-200/40 dark:border-zinc-700/30"},ct={class:"text-sm text-zinc-500 dark:text-zinc-400"},ut={class:"flex items-center gap-2"},pt={class:"text-sm text-zinc-600 dark:text-zinc-400"},xt={class:"flex flex-col w-[400px] p-8 gap-6"},_t={class:"flex items-center justify-between"},vt={class:"text-2xl font-semibold text-zinc-900 dark:text-zinc-100"},ft={class:"text-zinc-500 dark:text-zinc-400"},bt={class:"mb-4"},ht={class:"space-y-2"},yt={class:"block text-sm font-medium text-zinc-700 dark:text-zinc-300"},zt=["disabled","placeholder"],mt={class:"flex flex-row gap-3 items-center place-content-end"},gt={__name:"table-view",setup(wt){te();const Y=ie(),J=ne(),x=l(!1),p=l(""),f=l(null),E=l([]),r=l({page:1,per_page:50,total:0,total_pages:0}),w=l(null),k=l("ASC"),C=l(""),_=l("data"),V=l(!0),b=l(null),c=l(""),T=l(!1),P=l(null),L=async()=>{if(p.value){x.value=!0;try{const e={endpoint:`uixpress/v1/database/tables/${p.value}/structure`},a=await D(e);a&&a.data&&(f.value=a.data)}catch(e){v({title:(0,window.wp.i18n.__)("Error loading table structure","uixpress"),type:"error"}),console.error("Error fetching table structure:",e)}finally{x.value=!1}}},$=async()=>{if(p.value){x.value=!0;try{const e={page:r.value.page,per_page:r.value.per_page,order:k.value};w.value&&(e.orderby=w.value),C.value&&(e.search=C.value);const a={endpoint:`uixpress/v1/database/tables/${p.value}/data`,params:e},s=await D(a);s&&s.data&&(E.value=s.data.data||[],r.value={...r.value,...s.data.pagination})}catch(e){v({title:(0,window.wp.i18n.__)("Error loading table data","uixpress"),type:"error"}),console.error("Error fetching table data:",e)}finally{x.value=!1}}},R=e=>{w.value===e?k.value=k.value==="ASC"?"DESC":"ASC":(w.value=e,k.value="ASC"),r.value.page=1,$()},A=e=>{r.value.page=e,$()};let F=null;M(C,()=>{clearTimeout(F),F=setTimeout(()=>{r.value.page=1,$()},500)});const I=e=>{const a=document.createElement("div");return a.textContent=e,a.innerHTML},K=e=>e==null?'<span class="text-zinc-400 italic">NULL</span>':I(typeof e=="object"?JSON.stringify(e):String(e)),W=e=>e.split("(")[0].toUpperCase(),q=async()=>{try{const a=await D({endpoint:"uixpress/v1/database/tables"});if(a&&a.data){const s=a.data.find(u=>u.name===p.value);s&&(V.value=s.is_wp_table)}}catch(e){console.error("Error checking table type:",e)}},G=e=>{e.target.value&&!c.value&&(e.target.value="",c.value="")},Q=()=>{c.value="",b.value&&(b.value.show(),setTimeout(()=>{const e=document.querySelector('input[name="verify-password"]');e&&e.focus()},100))},j=async()=>{if(!c.value.trim()){v({title:(0,window.wp.i18n.__)("Please enter your password","uixpress"),type:"warning"});return}T.value=!0;try{const e={endpoint:"uixpress/v1/database/verify-password",type:"POST",data:{password:c.value}},a=await D(e);if(a&&a.data&&a.data.verified){const s=c.value;b.value&&b.value.close(),await P.value.show({title:(0,window.wp.i18n.__)("Delete Table?","uixpress"),message:(0,window.wp.i18n.sprintf)((0,window.wp.i18n.__)('Are you sure you want to delete the table "%s"? This action cannot be undone.',"uixpress"),p.value),okButton:(0,window.wp.i18n.__)("Yes, delete table","uixpress"),icon:"warning"})?(c.value=s,await X()):c.value=""}else v({title:(0,window.wp.i18n.__)("Invalid password","uixpress"),type:"error"})}catch{v({title:(0,window.wp.i18n.__)("Password verification failed","uixpress"),type:"error"})}finally{T.value=!1}},X=async()=>{x.value=!0;try{const e={endpoint:`uixpress/v1/database/tables/${p.value}`,type:"DELETE",data:{password:c.value}},a=await D(e);a&&a.data&&a.data.success?(v({title:a.data.message||(0,window.wp.i18n.__)("Table deleted successfully","uixpress"),type:"success"}),J.push("/")):v({title:(0,window.wp.i18n.__)("Failed to delete table","uixpress"),type:"error"})}catch{v({title:(0,window.wp.i18n.__)("Error deleting table","uixpress"),type:"error"})}finally{x.value=!1,c.value=""}};return M(()=>Y.params.tableName,e=>{e&&(p.value=e,_.value="data",r.value.page=1,C.value="",w.value=null,k.value="ASC",q(),L(),$())},{immediate:!0}),M(_,()=>{_.value==="structure"&&!f.value&&L()}),(e,a)=>(n(),o("div",le,[t("div",de,[t("div",ce,[t("div",null,[t("h2",ue,i(p.value),1),r.value.total>0?(n(),o("p",pe,i(r.value.total.toLocaleString())+" "+i(e.__("rows","uixpress")),1)):h("",!0)]),V.value?h("",!0):(n(),o("div",xe,[d(S,{onClick:Q,type:"transparent",class:"text-sm text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300"},{default:y(()=>[d(z,{icon:"delete",class:"text-base mr-2"}),N(" "+i(e.__("Delete Table","uixpress")),1)]),_:1})]))]),t("div",_e,[t("button",{onClick:a[0]||(a[0]=s=>_.value="structure"),class:O(["px-4 py-2 text-sm font-medium rounded-lg transition-colors",_.value==="structure"?"bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900":"bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-400 hover:bg-zinc-200 dark:hover:bg-zinc-700"])},i(e.__("Structure","uixpress")),3),t("button",{onClick:a[1]||(a[1]=s=>_.value="data"),class:O(["px-4 py-2 text-sm font-medium rounded-lg transition-colors",_.value==="data"?"bg-zinc-900 dark:bg-zinc-100 text-white dark:text-zinc-900":"bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-400 hover:bg-zinc-200 dark:hover:bg-zinc-700"])},i(e.__("Data","uixpress")),3)])]),_.value==="structure"?(n(),o("div",ve,[x.value?(n(),o("div",fe,[(n(),o(m,null,g(5,s=>t("div",{key:s,class:"h-16 rounded-lg bg-zinc-100 dark:bg-zinc-800 animate-pulse"})),64))])):f.value?(n(),o("div",be,[t("div",he,[t("h3",ye,i(e.__("Columns","uixpress")),1),t("div",ze,[t("table",me,[t("thead",ge,[t("tr",null,[t("th",we,i(e.__("Name","uixpress")),1),t("th",ke,i(e.__("Type","uixpress")),1),t("th",Ce,i(e.__("Null","uixpress")),1),t("th",Te,i(e.__("Key","uixpress")),1),t("th",Se,i(e.__("Default","uixpress")),1)])]),t("tbody",De,[(n(!0),o(m,null,g(f.value.columns,s=>(n(),o("tr",{key:s.Field,class:"hover:bg-zinc-50 dark:hover:bg-zinc-900/50 transition-colors"},[t("td",Ee,i(s.Field),1),t("td",$e,i(W(s.Type)),1),t("td",Ne,i(s.Null==="YES"?e.__("Yes","uixpress"):e.__("No","uixpress")),1),t("td",Me,[s.Key?(n(),o("span",Ve,i(s.Key),1)):h("",!0)]),t("td",Pe,i(s.Default||"-"),1)]))),128))])])])]),f.value.indexes&&f.value.indexes.length>0?(n(),o("div",Le,[t("h3",Ae,i(e.__("Indexes","uixpress")),1),t("div",Fe,[t("table",Ie,[t("thead",Ke,[t("tr",null,[t("th",je,i(e.__("Name","uixpress")),1),t("th",Be,i(e.__("Column","uixpress")),1),t("th",Oe,i(e.__("Type","uixpress")),1)])]),t("tbody",Ue,[(n(!0),o(m,null,g(f.value.indexes,s=>(n(),o("tr",{key:`${s.Key_name}-${s.Column_name}`,class:"hover:bg-zinc-50 dark:hover:bg-zinc-900/50 transition-colors"},[t("td",He,i(s.Key_name),1),t("td",Ye,i(s.Column_name),1),t("td",Je,i(s.Index_type),1)]))),128))])])])])):h("",!0)])):h("",!0)])):(n(),o("div",Re,[t("div",We,[t("div",qe,[d(z,{icon:"search",class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-zinc-400 dark:text-zinc-500 text-base pointer-events-none"}),U(t("input",{"onUpdate:modelValue":a[2]||(a[2]=s=>C.value=s),type:"text",placeholder:e.__("Search table data...","uixpress"),class:"w-full bg-zinc-50 dark:bg-zinc-900 border-0 rounded-lg pl-10 pr-3 py-2.5 text-sm placeholder-zinc-400 dark:placeholder-zinc-500 focus:outline-none focus:ring-2 focus:ring-zinc-900 dark:focus:ring-zinc-100 transition-shadow"},null,8,Ge),[[H,C.value]])])]),t("div",Qe,[x.value?(n(),o("div",Xe,[(n(),o(m,null,g(10,s=>t("div",{key:s,class:"h-12 rounded-lg bg-zinc-100 dark:bg-zinc-800 animate-pulse"})),64))])):E.value.length===0?(n(),o("div",Ze,[t("p",et,i(e.__("No data found","uixpress")),1)])):(n(),o("div",tt,[t("table",st,[t("thead",at,[t("tr",null,[(n(!0),o(m,null,g(Object.keys(E.value[0]||{}),s=>(n(),o("th",{key:s,onClick:u=>R(s),class:"px-4 py-3 text-left text-xs font-semibold text-zinc-500 dark:text-zinc-400 uppercase cursor-pointer hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-colors"},[t("div",nt,[N(i(s)+" ",1),w.value===s?(n(),se(z,{key:0,icon:k.value==="ASC"?"arrow_upward":"arrow_downward",class:"text-xs"},null,8,["icon"])):h("",!0)])],8,it))),128))])]),t("tbody",ot,[(n(!0),o(m,null,g(E.value,(s,u)=>(n(),o("tr",{key:u,class:"hover:bg-zinc-50 dark:hover:bg-zinc-900/50 transition-colors"},[(n(!0),o(m,null,g(s,(B,Z)=>(n(),o("td",{key:Z,class:"px-4 py-3 text-sm text-zinc-900 dark:text-zinc-100 max-w-xs truncate",title:K(B)},[t("span",{innerHTML:K(B)},null,8,lt)],8,rt))),128))]))),128))])])]))]),r.value.total_pages>1?(n(),o("div",dt,[t("div",ct,i(e.__("Showing","uixpress"))+" "+i((r.value.page-1)*r.value.per_page+1)+" - "+i(Math.min(r.value.page*r.value.per_page,r.value.total))+" "+i(e.__("of","uixpress"))+" "+i(r.value.total.toLocaleString()),1),t("div",ut,[d(S,{onClick:a[3]||(a[3]=s=>A(r.value.page-1)),disabled:r.value.page===1,type:"transparent",class:"text-sm"},{default:y(()=>[d(z,{icon:"chevron_left"})]),_:1},8,["disabled"]),t("span",pt,i(e.__("Page","uixpress"))+" "+i(r.value.page)+" / "+i(r.value.total_pages),1),d(S,{onClick:a[4]||(a[4]=s=>A(r.value.page+1)),disabled:r.value.page>=r.value.total_pages,type:"transparent",class:"text-sm"},{default:y(()=>[d(z,{icon:"chevron_right"})]),_:1},8,["disabled"])])])):h("",!0)])),d(oe,{ref_key:"passwordModal",ref:b},{default:y(()=>[t("div",xt,[t("div",_t,[t("h2",vt,i(e.__("Verify Password","uixpress")),1),d(S,{type:"transparent",onClick:a[5]||(a[5]=s=>{var u;return(u=b.value)==null?void 0:u.close()})},{default:y(()=>[d(z,{icon:"close"})]),_:1})]),t("div",ft,[t("p",bt,i(e.__("To delete this table, please enter your password to confirm.","uixpress")),1),t("div",ht,[t("label",yt,i(e.__("Password","uixpress")),1),a[8]||(a[8]=t("input",{type:"text",name:"username",autocomplete:"username",style:{position:"absolute",opacity:"0","pointer-events":"none",height:"0",width:"0"},tabindex:"-1"},null,-1)),a[9]||(a[9]=t("input",{type:"password",name:"password",autocomplete:"new-password",style:{position:"absolute",opacity:"0","pointer-events":"none",height:"0",width:"0"},tabindex:"-1"},null,-1)),U(t("input",{"onUpdate:modelValue":a[6]||(a[6]=s=>c.value=s),type:"password",name:"verify-password",disabled:T.value,onKeydown:ae(j,["enter"]),onFocus:G,autocomplete:"new-password",class:"w-full px-4 py-2 bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-700 rounded-lg text-zinc-900 dark:text-zinc-100 focus:outline-none focus:ring-2 focus:ring-zinc-900 dark:focus:ring-zinc-100 disabled:opacity-50",placeholder:e.__("Enter your password","uixpress"),autofocus:""},null,40,zt),[[H,c.value]])])]),t("div",mt,[d(S,{onClick:a[7]||(a[7]=s=>{var u;return(u=b.value)==null?void 0:u.close()}),type:"default",disabled:T.value},{default:y(()=>[N(i(e.__("Cancel","uixpress")),1)]),_:1},8,["disabled"]),d(S,{onClick:j,type:"primary",disabled:!c.value.trim()||T.value},{default:y(()=>[d(z,{icon:"check",class:"text-base mr-2"}),N(" "+i(T.value?e.__("Verifying...","uixpress"):e.__("Verify","uixpress")),1)]),_:1},8,["disabled"])])])]),_:1},512),d(re,{ref_key:"confirmDelete",ref:P},null,512)]))}},St=ee(gt,[["__scopeId","data-v-61022beb"]]);export{St as default};
//# sourceMappingURL=table-view-Cp9BNIv-.js.map
